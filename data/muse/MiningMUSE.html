<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
        <title>MiningMUSE</title>
        <style>:root
{
    --markdown-font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", system-ui, "Ubuntu", "Droid Sans", sans-serif;
    --markdown-font-size: 14px;
    --markdown-line-height: 1.6;
    --vscode-font-family:"Segoe WPC", "Segoe UI", sans-serif;
    --vscode-font-weight:normal;
    --vscode-font-size:13px;
    --vscode-editor-font-family:Consolas, "Courier New", monospace;
    --vscode-editor-font-weight:normal;
    --vscode-editor-font-size:14px;
    --vscode-foreground:#616161;
    --vscode-errorForeground:#a1260d;
    --vscode-descriptionForeground:#717171;
    --vscode-icon-foreground:#424242;
    --vscode-focusBorder:#0090f1;
    --vscode-textSeparator-foreground:rgba(0, 0, 0, 0.18);
    --vscode-textLink-foreground:#006ab1;
    --vscode-textLink-activeForeground:#006ab1;
    --vscode-textPreformat-foreground:#a31515;
    --vscode-textBlockQuote-background:rgba(127, 127, 127, 0.1);
    --vscode-textBlockQuote-border:rgba(0, 122, 204, 0.5);
    --vscode-textCodeBlock-background:rgba(220, 220, 220, 0.4);
    --vscode-widget-shadow:#a8a8a8;
    --vscode-input-background:#ffffff;
    --vscode-input-foreground:#616161;
    --vscode-inputOption-activeBorder:rgba(0, 122, 204, 0);
    --vscode-inputOption-activeBackground:rgba(0, 144, 241, 0.2);
    --vscode-inputOption-activeForeground:#000000;
    --vscode-input-placeholderForeground:#767676;
    --vscode-inputValidation-infoBackground:#d6ecf2;
    --vscode-inputValidation-infoBorder:#007acc;
    --vscode-inputValidation-warningBackground:#f6f5d2;
    --vscode-inputValidation-warningBorder:#b89500;
    --vscode-inputValidation-errorBackground:#f2dede;
    --vscode-inputValidation-errorBorder:#be1100;
    --vscode-dropdown-background:#ffffff;
    --vscode-dropdown-border:#cecece;
    --vscode-checkbox-background:#ffffff;
    --vscode-checkbox-border:#cecece;
    --vscode-button-foreground:#ffffff;
    --vscode-button-background:#007acc;
    --vscode-button-hoverBackground:#0062a3;
    --vscode-button-secondaryForeground:#ffffff;
    --vscode-button-secondaryBackground:#5f6a79;
    --vscode-button-secondaryHoverBackground:#4c5561;
    --vscode-badge-background:#c4c4c4;
    --vscode-badge-foreground:#333333;
    --vscode-scrollbar-shadow:#dddddd;
    --vscode-scrollbarSlider-background:rgba(100, 100, 100, 0.4);
    --vscode-scrollbarSlider-hoverBackground:rgba(100, 100, 100, 0.7);
    --vscode-scrollbarSlider-activeBackground:rgba(0, 0, 0, 0.6);
    --vscode-progressBar-background:#0e70c0;
    --vscode-editorError-foreground:#e51400;
    --vscode-editorWarning-foreground:#e9a700;
    --vscode-editorInfo-foreground:#75beff;
    --vscode-editorHint-foreground:#6c6c6c;
    --vscode-editor-background:#ffffff;
    --vscode-editor-foreground:#000000;
    --vscode-editorWidget-background:#f3f3f3;
    --vscode-editorWidget-foreground:#616161;
    --vscode-editorWidget-border:#c8c8c8;
    --vscode-quickInput-background:#f3f3f3;
    --vscode-quickInput-foreground:#616161;
    --vscode-quickInputTitle-background:rgba(0, 0, 0, 0.06);
    --vscode-pickerGroup-foreground:#0066bf;
    --vscode-pickerGroup-border:#cccedb;
    --vscode-editor-selectionBackground:#add6ff;
    --vscode-editor-inactiveSelectionBackground:#e5ebf1;
    --vscode-editor-selectionHighlightBackground:rgba(173, 214, 255, 0.5);
    --vscode-editor-findMatchBackground:#a8ac94;
    --vscode-editor-findMatchHighlightBackground:rgba(234, 92, 0, 0.33);
    --vscode-editor-findRangeHighlightBackground:rgba(180, 180, 180, 0.3);
    --vscode-searchEditor-findMatchBackground:rgba(234, 92, 0, 0.22);
    --vscode-editor-hoverHighlightBackground:rgba(173, 214, 255, 0.15);
    --vscode-editorHoverWidget-background:#f3f3f3;
    --vscode-editorHoverWidget-foreground:#616161;
    --vscode-editorHoverWidget-border:#c8c8c8;
    --vscode-editorHoverWidget-statusBarBackground:#e7e7e7;
    --vscode-editorLink-activeForeground:#0000ff;
    --vscode-editorLightBulb-foreground:#ddb100;
    --vscode-editorLightBulbAutoFix-foreground:#007acc;
    --vscode-diffEditor-insertedTextBackground:rgba(155, 185, 85, 0.2);
    --vscode-diffEditor-removedTextBackground:rgba(255, 0, 0, 0.2);
    --vscode-diffEditor-diagonalFill:rgba(34, 34, 34, 0.2);
    --vscode-list-focusBackground:#d6ebff;
    --vscode-list-activeSelectionBackground:#0074e8;
    --vscode-list-activeSelectionForeground:#ffffff;
    --vscode-list-inactiveSelectionBackground:#e4e6f1;
    --vscode-list-hoverBackground:#e8e8e8;
    --vscode-list-dropBackground:#d6ebff;
    --vscode-list-highlightForeground:#0066bf;
    --vscode-list-invalidItemForeground:#b89500;
    --vscode-list-errorForeground:#b01011;
    --vscode-list-warningForeground:#855f00;
    --vscode-listFilterWidget-background:#efc1ad;
    --vscode-listFilterWidget-outline:rgba(0, 0, 0, 0);
    --vscode-listFilterWidget-noMatchesOutline:#be1100;
    --vscode-list-filterMatchBackground:rgba(234, 92, 0, 0.33);
    --vscode-tree-indentGuidesStroke:#a9a9a9;
    --vscode-list-deemphasizedForeground:#8e8e90;
    --vscode-menu-foreground:#616161;
    --vscode-menu-background:#ffffff;
    --vscode-menu-selectionForeground:#ffffff;
    --vscode-menu-selectionBackground:#0074e8;
    --vscode-menu-separatorBackground:#888888;
    --vscode-editor-snippetTabstopHighlightBackground:rgba(10, 50, 100, 0.2);
    --vscode-editor-snippetFinalTabstopHighlightBorder:rgba(10, 50, 100, 0.5);
    --vscode-breadcrumb-foreground:rgba(97, 97, 97, 0.8);
    --vscode-breadcrumb-background:#ffffff;
    --vscode-breadcrumb-focusForeground:#4e4e4e;
    --vscode-breadcrumb-activeSelectionForeground:#4e4e4e;
    --vscode-breadcrumbPicker-background:#f3f3f3;
    --vscode-merge-currentHeaderBackground:rgba(64, 200, 174, 0.5);
    --vscode-merge-currentContentBackground:rgba(64, 200, 174, 0.2);
    --vscode-merge-incomingHeaderBackground:rgba(64, 166, 255, 0.5);
    --vscode-merge-incomingContentBackground:rgba(64, 166, 255, 0.2);
    --vscode-merge-commonHeaderBackground:rgba(96, 96, 96, 0.4);
    --vscode-merge-commonContentBackground:rgba(96, 96, 96, 0.16);
    --vscode-editorOverviewRuler-currentContentForeground:rgba(64, 200, 174, 0.5);
    --vscode-editorOverviewRuler-incomingContentForeground:rgba(64, 166, 255, 0.5);
    --vscode-editorOverviewRuler-commonContentForeground:rgba(96, 96, 96, 0.4);
    --vscode-editorOverviewRuler-findMatchForeground:rgba(209, 134, 22, 0.49);
    --vscode-editorOverviewRuler-selectionHighlightForeground:rgba(160, 160, 160, 0.8);
    --vscode-minimap-findMatchHighlight:#d18616;
    --vscode-minimap-selectionHighlight:#add6ff;
    --vscode-minimap-errorHighlight:rgba(255, 18, 18, 0.7);
    --vscode-minimap-warningHighlight:#e9a700;
    --vscode-minimapSlider-background:rgba(100, 100, 100, 0.2);
    --vscode-minimapSlider-hoverBackground:rgba(100, 100, 100, 0.35);
    --vscode-minimapSlider-activeBackground:rgba(0, 0, 0, 0.3);
    --vscode-problemsErrorIcon-foreground:#e51400;
    --vscode-problemsWarningIcon-foreground:#e9a700;
    --vscode-problemsInfoIcon-foreground:#75beff;
    --vscode-editor-lineHighlightBorder:#eeeeee;
    --vscode-editor-rangeHighlightBackground:rgba(253, 255, 0, 0.2);
    --vscode-editor-symbolHighlightBackground:rgba(234, 92, 0, 0.33);
    --vscode-editorCursor-foreground:#000000;
    --vscode-editorWhitespace-foreground:rgba(51, 51, 51, 0.2);
    --vscode-editorIndentGuide-background:#d3d3d3;
    --vscode-editorIndentGuide-activeBackground:#939393;
    --vscode-editorLineNumber-foreground:#237893;
    --vscode-editorActiveLineNumber-foreground:#0b216f;
    --vscode-editorLineNumber-activeForeground:#0b216f;
    --vscode-editorRuler-foreground:#d3d3d3;
    --vscode-editorCodeLens-foreground:#999999;
    --vscode-editorBracketMatch-background:rgba(0, 100, 0, 0.1);
    --vscode-editorBracketMatch-border:#b9b9b9;
    --vscode-editorOverviewRuler-border:rgba(127, 127, 127, 0.3);
    --vscode-editorGutter-background:#ffffff;
    --vscode-editorUnnecessaryCode-opacity:rgba(0, 0, 0, 0.47);
    --vscode-editorOverviewRuler-rangeHighlightForeground:rgba(0, 122, 204, 0.6);
    --vscode-editorOverviewRuler-errorForeground:rgba(255, 18, 18, 0.7);
    --vscode-editorOverviewRuler-warningForeground:#e9a700;
    --vscode-editorOverviewRuler-infoForeground:#75beff;
    --vscode-editorOverviewRuler-bracketMatchForeground:#a0a0a0;
    --vscode-symbolIcon-arrayForeground:#616161;
    --vscode-symbolIcon-booleanForeground:#616161;
    --vscode-symbolIcon-classForeground:#d67e00;
    --vscode-symbolIcon-colorForeground:#616161;
    --vscode-symbolIcon-constantForeground:#616161;
    --vscode-symbolIcon-constructorForeground:#652d90;
    --vscode-symbolIcon-enumeratorForeground:#d67e00;
    --vscode-symbolIcon-enumeratorMemberForeground:#007acc;
    --vscode-symbolIcon-eventForeground:#d67e00;
    --vscode-symbolIcon-fieldForeground:#007acc;
    --vscode-symbolIcon-fileForeground:#616161;
    --vscode-symbolIcon-folderForeground:#616161;
    --vscode-symbolIcon-functionForeground:#652d90;
    --vscode-symbolIcon-interfaceForeground:#007acc;
    --vscode-symbolIcon-keyForeground:#616161;
    --vscode-symbolIcon-keywordForeground:#616161;
    --vscode-symbolIcon-methodForeground:#652d90;
    --vscode-symbolIcon-moduleForeground:#616161;
    --vscode-symbolIcon-namespaceForeground:#616161;
    --vscode-symbolIcon-nullForeground:#616161;
    --vscode-symbolIcon-numberForeground:#616161;
    --vscode-symbolIcon-objectForeground:#616161;
    --vscode-symbolIcon-operatorForeground:#616161;
    --vscode-symbolIcon-packageForeground:#616161;
    --vscode-symbolIcon-propertyForeground:#616161;
    --vscode-symbolIcon-referenceForeground:#616161;
    --vscode-symbolIcon-snippetForeground:#616161;
    --vscode-symbolIcon-stringForeground:#616161;
    --vscode-symbolIcon-structForeground:#616161;
    --vscode-symbolIcon-textForeground:#616161;
    --vscode-symbolIcon-typeParameterForeground:#616161;
    --vscode-symbolIcon-unitForeground:#616161;
    --vscode-symbolIcon-variableForeground:#007acc;
    --vscode-editor-foldBackground:rgba(173, 214, 255, 0.3);
    --vscode-editorGutter-foldingControlForeground:#424242;
    --vscode-editor-onTypeRenameBackground:rgba(255, 0, 0, 0.3);
    --vscode-editorSuggestWidget-background:#f3f3f3;
    --vscode-editorSuggestWidget-border:#c8c8c8;
    --vscode-editorSuggestWidget-foreground:#000000;
    --vscode-editorSuggestWidget-selectedBackground:#d6ebff;
    --vscode-editorSuggestWidget-highlightForeground:#0066bf;
    --vscode-editor-wordHighlightBackground:rgba(87, 87, 87, 0.25);
    --vscode-editor-wordHighlightStrongBackground:rgba(14, 99, 156, 0.25);
    --vscode-editorOverviewRuler-wordHighlightForeground:rgba(160, 160, 160, 0.8);
    --vscode-editorOverviewRuler-wordHighlightStrongForeground:rgba(192, 160, 192, 0.8);
    --vscode-peekViewTitle-background:#ffffff;
    --vscode-peekViewTitleLabel-foreground:#333333;
    --vscode-peekViewTitleDescription-foreground:rgba(97, 97, 97, 0.9);
    --vscode-peekView-border:#007acc;
    --vscode-peekViewResult-background:#f3f3f3;
    --vscode-peekViewResult-lineForeground:#646465;
    --vscode-peekViewResult-fileForeground:#1e1e1e;
    --vscode-peekViewResult-selectionBackground:rgba(51, 153, 255, 0.2);
    --vscode-peekViewResult-selectionForeground:#6c6c6c;
    --vscode-peekViewEditor-background:#f2f8fc;
    --vscode-peekViewEditorGutter-background:#f2f8fc;
    --vscode-peekViewResult-matchHighlightBackground:rgba(234, 92, 0, 0.3);
    --vscode-peekViewEditor-matchHighlightBackground:rgba(245, 216, 2, 0.87);
    --vscode-editorMarkerNavigationError-background:#e51400;
    --vscode-editorMarkerNavigationWarning-background:#e9a700;
    --vscode-editorMarkerNavigationInfo-background:#75beff;
    --vscode-editorMarkerNavigation-background:#ffffff;
    --vscode-tab-activeBackground:#ffffff;
    --vscode-tab-unfocusedActiveBackground:#ffffff;
    --vscode-tab-inactiveBackground:#ececec;
    --vscode-tab-unfocusedInactiveBackground:#ececec;
    --vscode-tab-activeForeground:#333333;
    --vscode-tab-inactiveForeground:rgba(51, 51, 51, 0.7);
    --vscode-tab-unfocusedActiveForeground:rgba(51, 51, 51, 0.7);
    --vscode-tab-unfocusedInactiveForeground:rgba(51, 51, 51, 0.35);
    --vscode-tab-activeModifiedBorder:#33aaee;
    --vscode-tab-inactiveModifiedBorder:rgba(51, 170, 238, 0.5);
    --vscode-tab-unfocusedActiveModifiedBorder:rgba(51, 170, 238, 0.7);
    --vscode-tab-unfocusedInactiveModifiedBorder:rgba(51, 170, 238, 0.25);
    --vscode-tab-border:#f3f3f3;
    --vscode-editorPane-background:#ffffff;
    --vscode-editorGroupHeader-tabsBackground:#f3f3f3;
    --vscode-editorGroupHeader-noTabsBackground:#ffffff;
    --vscode-editorGroup-border:#e7e7e7;
    --vscode-editorGroup-dropBackground:rgba(38, 119, 203, 0.18);
    --vscode-imagePreview-border:rgba(128, 128, 128, 0.35);
    --vscode-panel-background:#ffffff;
    --vscode-panel-border:rgba(128, 128, 128, 0.35);
    --vscode-panelTitle-activeForeground:#424242;
    --vscode-panelTitle-inactiveForeground:rgba(66, 66, 66, 0.75);
    --vscode-panelTitle-activeBorder:#424242;
    --vscode-panelInput-border:#dddddd;
    --vscode-panel-dropBorder:#424242;
    --vscode-panelSection-dropBackground:rgba(38, 119, 203, 0.18);
    --vscode-panelSectionHeader-background:rgba(128, 128, 128, 0.2);
    --vscode-panelSection-border:rgba(128, 128, 128, 0.35);
    --vscode-statusBar-foreground:#ffffff;
    --vscode-statusBar-noFolderForeground:#ffffff;
    --vscode-statusBar-background:#007acc;
    --vscode-statusBar-noFolderBackground:#68217a;
    --vscode-statusBarItem-activeBackground:rgba(255, 255, 255, 0.18);
    --vscode-statusBarItem-hoverBackground:rgba(255, 255, 255, 0.12);
    --vscode-statusBarItem-prominentForeground:#ffffff;
    --vscode-statusBarItem-prominentBackground:rgba(0, 0, 0, 0.5);
    --vscode-statusBarItem-prominentHoverBackground:rgba(0, 0, 0, 0.3);
    --vscode-activityBar-background:#2c2c2c;
    --vscode-activityBar-foreground:#ffffff;
    --vscode-activityBar-inactiveForeground:rgba(255, 255, 255, 0.4);
    --vscode-activityBar-activeBorder:#ffffff;
    --vscode-activityBar-dropBorder:#ffffff;
    --vscode-activityBarBadge-background:#007acc;
    --vscode-activityBarBadge-foreground:#ffffff;
    --vscode-statusBarItem-remoteBackground:#16825d;
    --vscode-statusBarItem-remoteForeground:#ffffff;
    --vscode-extensionBadge-remoteBackground:#007acc;
    --vscode-extensionBadge-remoteForeground:#ffffff;
    --vscode-sideBar-background:#f3f3f3;
    --vscode-sideBarTitle-foreground:#6f6f6f;
    --vscode-sideBar-dropBackground:rgba(38, 119, 203, 0.18);
    --vscode-sideBarSectionHeader-background:rgba(0, 0, 0, 0);
    --vscode-sideBarSectionHeader-border:rgba(97, 97, 97, 0.19);
    --vscode-titleBar-activeForeground:#333333;
    --vscode-titleBar-inactiveForeground:rgba(51, 51, 51, 0.6);
    --vscode-titleBar-activeBackground:#dddddd;
    --vscode-titleBar-inactiveBackground:rgba(221, 221, 221, 0.6);
    --vscode-menubar-selectionForeground:#333333;
    --vscode-menubar-selectionBackground:rgba(0, 0, 0, 0.1);
    --vscode-notifications-foreground:#616161;
    --vscode-notifications-background:#f3f3f3;
    --vscode-notificationLink-foreground:#006ab1;
    --vscode-notificationCenterHeader-background:#e7e7e7;
    --vscode-notifications-border:#e7e7e7;
    --vscode-notificationsErrorIcon-foreground:#e51400;
    --vscode-notificationsWarningIcon-foreground:#e9a700;
    --vscode-notificationsInfoIcon-foreground:#75beff;
    --vscode-editorGutter-commentRangeForeground:#c5c5c5;
    --vscode-editor-stackFrameHighlightBackground:rgba(255, 255, 102, 0.45);
    --vscode-editor-focusedStackFrameHighlightBackground:rgba(206, 231, 206, 0.45);
    --vscode-terminal-foreground:#333333;
    --vscode-terminal-selectionBackground:rgba(0, 0, 0, 0.25);
    --vscode-terminal-border:rgba(128, 128, 128, 0.35);
    --vscode-statusBar-debuggingBackground:#cc6633;
    --vscode-statusBar-debuggingForeground:#ffffff;
    --vscode-settings-headerForeground:#444444;
    --vscode-settings-modifiedItemIndicator:#66afe0;
    --vscode-settings-dropdownBackground:#ffffff;
    --vscode-settings-dropdownBorder:#cecece;
    --vscode-settings-dropdownListBorder:#c8c8c8;
    --vscode-settings-checkboxBackground:#ffffff;
    --vscode-settings-checkboxBorder:#cecece;
    --vscode-settings-textInputBackground:#ffffff;
    --vscode-settings-textInputForeground:#616161;
    --vscode-settings-textInputBorder:#cecece;
    --vscode-settings-numberInputBackground:#ffffff;
    --vscode-settings-numberInputForeground:#616161;
    --vscode-settings-numberInputBorder:#cecece;
    --vscode-debugExceptionWidget-border:#a31515;
    --vscode-debugExceptionWidget-background:#f1dfde;
    --vscode-editorGutter-modifiedBackground:#66afe0;
    --vscode-editorGutter-addedBackground:#81b88b;
    --vscode-editorGutter-deletedBackground:#ca4b51;
    --vscode-minimapGutter-modifiedBackground:#66afe0;
    --vscode-minimapGutter-addedBackground:#81b88b;
    --vscode-minimapGutter-deletedBackground:#ca4b51;
    --vscode-editorOverviewRuler-modifiedForeground:rgba(102, 175, 224, 0.6);
    --vscode-editorOverviewRuler-addedForeground:rgba(129, 184, 139, 0.6);
    --vscode-editorOverviewRuler-deletedForeground:rgba(202, 75, 81, 0.6);
    --vscode-searchEditor-textInputBorder:#cecece;
    --vscode-debugIcon-breakpointForeground:#e51400;
    --vscode-debugIcon-breakpointDisabledForeground:#848484;
    --vscode-debugIcon-breakpointUnverifiedForeground:#848484;
    --vscode-debugIcon-breakpointCurrentStackframeForeground:#ffcc00;
    --vscode-debugIcon-breakpointStackframeForeground:#89d185;
    --vscode-debugToolBar-background:#f3f3f3;
    --vscode-debugIcon-startForeground:#388a34;
    --vscode-debugIcon-pauseForeground:#007acc;
    --vscode-debugIcon-stopForeground:#a1260d;
    --vscode-debugIcon-disconnectForeground:#a1260d;
    --vscode-debugIcon-restartForeground:#388a34;
    --vscode-debugIcon-stepOverForeground:#007acc;
    --vscode-debugIcon-stepIntoForeground:#007acc;
    --vscode-debugIcon-stepOutForeground:#007acc;
    --vscode-debugIcon-continueForeground:#007acc;
    --vscode-debugIcon-stepBackForeground:#007acc;
    --vscode-debugTokenExpression-name:#9b46b0;
    --vscode-debugTokenExpression-value:rgba(108, 108, 108, 0.8);
    --vscode-debugTokenExpression-string:#a31515;
    --vscode-debugTokenExpression-boolean:#0000ff;
    --vscode-debugTokenExpression-number:#098658;
    --vscode-debugTokenExpression-error:#e51400;
    --vscode-debugView-exceptionLabelForeground:#ffffff;
    --vscode-debugView-exceptionLabelBackground:#a31515;
    --vscode-debugView-stateLabelForeground:#616161;
    --vscode-debugView-stateLabelBackground:rgba(136, 136, 136, 0.27);
    --vscode-debugView-valueChangedHighlight:#569cd6;
    --vscode-debugConsole-infoForeground:#75beff;
    --vscode-debugConsole-warningForeground:#e9a700;
    --vscode-debugConsole-errorForeground:#a1260d;
    --vscode-debugConsole-sourceForeground:#616161;
    --vscode-debugConsoleInputIcon-foreground:#616161;
    --vscode-extensionButton-prominentBackground:#327e36;
    --vscode-extensionButton-prominentForeground:#ffffff;
    --vscode-extensionButton-prominentHoverBackground:#28632b;
    --vscode-notebook-cellBorderColor:#dae3e9;
    --vscode-notebook-focusedEditorBorder:#0090f1;
    --vscode-notebookStatusSuccessIcon-foreground:#388a34;
    --vscode-notebookStatusErrorIcon-foreground:#a1260d;
    --vscode-notebookStatusRunningIcon-foreground:#616161;
    --vscode-notebook-outputContainerBackgroundColor:rgba(200, 221, 241, 0.31);
    --vscode-notebook-cellToolbarSeparator:rgba(128, 128, 128, 0.35);
    --vscode-notebook-focusedCellBackground:rgba(200, 221, 241, 0.31);
    --vscode-notebook-cellHoverBackground:rgba(200, 221, 241, 0.22);
    --vscode-notebook-focusedCellBorder:rgba(0, 0, 0, 0.12);
    --vscode-notebook-cellStatusBarItemHoverBackground:rgba(0, 0, 0, 0.08);
    --vscode-notebook-cellInsertionIndicator:#0090f1;
    --vscode-notebookScrollbarSlider-background:rgba(100, 100, 100, 0.4);
    --vscode-notebookScrollbarSlider-hoverBackground:rgba(100, 100, 100, 0.7);
    --vscode-notebookScrollbarSlider-activeBackground:rgba(0, 0, 0, 0.6);
    --vscode-notebook-symbolHighlightBackground:rgba(253, 255, 0, 0.2);
    --vscode-scm-providerBorder:#c8c8c8;
    --vscode-terminal-ansiBlack:#000000;
    --vscode-terminal-ansiRed:#cd3131;
    --vscode-terminal-ansiGreen:#00bc00;
    --vscode-terminal-ansiYellow:#949800;
    --vscode-terminal-ansiBlue:#0451a5;
    --vscode-terminal-ansiMagenta:#bc05bc;
    --vscode-terminal-ansiCyan:#0598bc;
    --vscode-terminal-ansiWhite:#555555;
    --vscode-terminal-ansiBrightBlack:#666666;
    --vscode-terminal-ansiBrightRed:#cd3131;
    --vscode-terminal-ansiBrightGreen:#14ce14;
    --vscode-terminal-ansiBrightYellow:#b5ba00;
    --vscode-terminal-ansiBrightBlue:#0451a5;
    --vscode-terminal-ansiBrightMagenta:#bc05bc;
    --vscode-terminal-ansiBrightCyan:#0598bc;
    --vscode-terminal-ansiBrightWhite:#a5a5a5;
    --vscode-gitDecoration-addedResourceForeground:#587c0c;
    --vscode-gitDecoration-modifiedResourceForeground:#895503;
    --vscode-gitDecoration-deletedResourceForeground:#ad0707;
    --vscode-gitDecoration-untrackedResourceForeground:#007100;
    --vscode-gitDecoration-ignoredResourceForeground:#8e8e90;
    --vscode-gitDecoration-conflictingResourceForeground:#6c6cc4;
    --vscode-gitDecoration-submoduleResourceForeground:#1258a7;
    --vscode-gitlens-gutterBackgroundColor:rgba(0, 0, 0, 0.05);
    --vscode-gitlens-gutterForegroundColor:#747474;
    --vscode-gitlens-gutterUncommittedForegroundColor:rgba(0, 188, 242, 0.6);
    --vscode-gitlens-trailingLineBackgroundColor:rgba(0, 0, 0, 0);
    --vscode-gitlens-trailingLineForegroundColor:rgba(153, 153, 153, 0.35);
    --vscode-gitlens-lineHighlightBackgroundColor:rgba(0, 188, 242, 0.2);
    --vscode-gitlens-lineHighlightOverviewRulerColor:rgba(0, 188, 242, 0.6);
    --vscode-issues-newIssueDecoration:rgba(0, 0, 0, 0.28);
}

body
{
    background-color: var(--vscode-editor-background);
    color: var(--vscode-editor-foreground);
    font-family: var(--vscode-font-family);
    font-weight: var(--vscode-font-weight);
    font-size: var(--vscode-font-size);
    margin: 0;
    padding: 0 20px;
}

img
{
    max-width: 100%;
    max-height: 100%;
}

a
{
    color: var(--vscode-textLink-foreground);
}

a:hover
{
    color: var(--vscode-textLink-activeForeground);
}

a:focus,
input:focus,
select:focus,
textarea:focus
{
    outline: 1px solid -webkit-focus-ring-color;
    outline-offset: -1px;
}

code
{
    color: var(--vscode-textPreformat-foreground);
}

blockquote
{
    background: var(--vscode-textBlockQuote-background);
    border-color: var(--vscode-textBlockQuote-border);
}

kbd
{
    color: var(--vscode-editor-foreground);
    border-radius: 3px;
    vertical-align: middle;
    padding: 1px 3px;

    background-color: hsla(0,0%,50%,.17);
    border: 1px solid rgba(71,71,71,.4);
    border-bottom-color: rgba(88,88,88,.4);
    box-shadow: inset 0 -1px 0 rgba(88,88,88,.4);
}

.vscode-light kbd
{
    background-color: hsla(0,0%,87%,.5);
    border: 1px solid hsla(0,0%,80%,.7);
    border-bottom-color: hsla(0,0%,73%,.7);
    box-shadow: inset 0 -1px 0 hsla(0,0%,73%,.7);
}

::-webkit-scrollbar
{
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-corner
{
    background-color: var(--vscode-editor-background);
}

::-webkit-scrollbar-thumb
{
    background-color: var(--vscode-scrollbarSlider-background);
}
::-webkit-scrollbar-thumb:hover
{
    background-color: var(--vscode-scrollbarSlider-hoverBackground);
}
::-webkit-scrollbar-thumb:active
{
    background-color: var(--vscode-scrollbarSlider-activeBackground);
}

.emoji
{
    height: 20px;
}

pre
{
    white-space: pre-wrap;
}

.page-break
{
    display: block;
    page-break-after: always;
}

.no-page-break
{
    page-break-inside: avoid;
}
</style>
<style>/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}
</style>
<style>/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

html, body {
	font-family: var(--markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", system-ui, "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--markdown-line-height, 22px);
	word-wrap: break-word;
}

body {
	padding-top: 1em;
}

/* Reset margin top for elements */
h1, h2, h3, h4, h5, h6,
p, ol, ul, pre {
	margin-top: 0;
}

h1, h2, h3, h4, h5, h6 {
	font-weight: 600;
	margin-top: 24px;
	margin-bottom: 16px;
	line-height: 1.25;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection :not(tr,ul,ol).code-active-line:before,
body.showEditorSelection :not(tr,ul,ol).code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

.vscode-high-contrast.showEditorSelection  :not(tr,ul,ol).code-line .code-line:hover:before {
	border-left: none;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

/* Prevent `sub` and `sup` elements from affecting line height */
sub,
sup {
	line-height: 0;
}

ul ul:first-child,
ul ol:first-child,
ol ul:first-child,
ol ol:first-child {
	margin-bottom: 0;
}

img, video {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

p {
	margin-bottom: 16px;
}

li p {
	margin-bottom: 0.7em;
}

ul,
ol {
	margin-bottom: 0.7em;
}

hr {
	border: 0;
	height: 1px;
	border-bottom: 1px solid;
}

h1 {
	font-size: 2em;
	margin-top: 0;
	padding-bottom: 0.3em;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h2 {
	font-size: 1.5em;
	padding-bottom: 0.3em;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h3 {
	font-size: 1.25em;
}

h4 {
	font-size: 1em;
}

h5 {
	font-size: 0.875em;
}

h6 {
	font-size: 0.85em;
}

table {
	border-collapse: collapse;
	margin-bottom: 0.7em;
}

th {
	text-align: left;
	border-bottom: 1px solid;
}

th,
td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0;
	padding: 0px 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
	border-radius: 2px;
}

code {
	font-family: var(--vscode-editor-font-family, "SF Mono", Monaco, Menlo, Consolas, "Ubuntu Mono", "Liberation Mono", "DejaVu Sans Mono", "Courier New", monospace);
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	display: inline-block;
	color: var(--vscode-editor-foreground);
	tab-size: 4;
	background: none;
}

/** Theming */

pre {
	background-color: var(--vscode-textCodeBlock-background);
	border: 1px solid var(--vscode-widget-border);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light h2,
.vscode-light hr,
.vscode-light td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark h2,
.vscode-dark hr,
.vscode-dark td {
	border-color: rgba(255, 255, 255, 0.18);
}
</style>
<style>/*
https://raw.githubusercontent.com/isagalaev/highlight.js/master/src/styles/vs2015.css
*/
/*
 * Visual Studio 2015 dark style
 * Author: Nicolas LLOBERA <nllobera@gmail.com>
 */


.hljs-keyword,
.hljs-literal,
.hljs-symbol,
.hljs-name {
	color: #569CD6;
}
.hljs-link {
	color: #569CD6;
	text-decoration: underline;
}

.hljs-built_in,
.hljs-type {
	color: #4EC9B0;
}

.hljs-number,
.hljs-class {
	color: #B8D7A3;
}

.hljs-string,
.hljs-meta-string {
	color: #D69D85;
}

.hljs-regexp,
.hljs-template-tag {
	color: #9A5334;
}

.hljs-subst,
.hljs-function,
.hljs-title,
.hljs-params,
.hljs-formula {
	color: #DCDCDC;
}

.hljs-comment,
.hljs-quote {
	color: #57A64A;
	font-style: italic;
}

.hljs-doctag {
	color: #608B4E;
}

.hljs-meta,
.hljs-meta-keyword,
.hljs-tag {
	color: #9B9B9B;
}

.hljs-variable,
.hljs-template-variable {
	color: #BD63C5;
}

.hljs-attr,
.hljs-attribute,
.hljs-builtin-name {
	color: #9CDCFE;
}

.hljs-section {
	color: gold;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}

/*.hljs-code {
	font-family:'Monospace';
}*/

.hljs-bullet,
.hljs-selector-tag,
.hljs-selector-id,
.hljs-selector-class,
.hljs-selector-attr,
.hljs-selector-pseudo {
	color: #D7BA7D;
}

.hljs-addition {
	background-color: var(--vscode-diffEditor-insertedTextBackground, rgba(155, 185, 85, 0.2));
	color: rgb(155, 185, 85);
	display: inline-block;
	width: 100%;
}

.hljs-deletion {
	background: var(--vscode-diffEditor-removedTextBackground, rgba(255, 0, 0, 0.2));
	color: rgb(255, 0, 0);
	display: inline-block;
	width: 100%;
}


/*
From https://raw.githubusercontent.com/isagalaev/highlight.js/master/src/styles/vs.css
*/
/*

Visual Studio-like style based on original C# coloring by Jason Diamond <jason@diamond.name>

*/

.vscode-light .hljs-function,
.vscode-light .hljs-params,
.vscode-light .hljs-number,
.vscode-light .hljs-class  {
	color: inherit;
}

.vscode-light .hljs-comment,
.vscode-light .hljs-quote,
.vscode-light .hljs-number,
.vscode-light .hljs-class,
.vscode-light .hljs-variable {
	color: #008000;
}

.vscode-light .hljs-keyword,
.vscode-light .hljs-selector-tag,
.vscode-light .hljs-name,
.vscode-light .hljs-tag {
	color: #00f;
}

.vscode-light .hljs-built_in,
.vscode-light .hljs-builtin-name {
	color: #007acc;
}

.vscode-light .hljs-string,
.vscode-light .hljs-section,
.vscode-light .hljs-attribute,
.vscode-light .hljs-literal,
.vscode-light .hljs-template-tag,
.vscode-light .hljs-template-variable,
.vscode-light .hljs-type {
	color: #a31515;
}

.vscode-light .hljs-subst,
.vscode-light .hljs-selector-attr,
.vscode-light .hljs-selector-pseudo,
.vscode-light .hljs-meta,
.vscode-light .hljs-meta-keyword {
	color: #2b91af;
}
.vscode-light .hljs-title,
.vscode-light .hljs-doctag {
	color: #808080;
}

.vscode-light .hljs-attr {
	color: #f00;
}

.vscode-light .hljs-symbol,
.vscode-light .hljs-bullet,
.vscode-light .hljs-link {
	color: #00b0e8;
}


.vscode-light .hljs-emphasis {
	font-style: italic;
}

.vscode-light .hljs-strong {
	font-weight: bold;
}
</style>
<style>@font-face{font-family:KaTeX_AMS;font-style:normal;font-weight:400;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Caligraphic;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Fraktur;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:700;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype")}@font-face{font-family:KaTeX_Main;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:700;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype")}@font-face{font-family:KaTeX_Math;font-style:italic;font-weight:400;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:700;src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:italic;font-weight:400;src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype")}@font-face{font-family:"KaTeX_SansSerif";font-style:normal;font-weight:400;src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Script;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size1;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size2;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size3;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Size4;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype")}@font-face{font-family:KaTeX_Typewriter;font-style:normal;font-weight:400;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype")}.katex{font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0;text-rendering:auto}.katex *{-ms-high-contrast-adjust:none!important;border-color:currentColor}.katex .katex-version:after{content:"0.16.21"}.katex .katex-mathml{clip:rect(1px,1px,1px,1px);border:0;height:1px;overflow:hidden;padding:0;position:absolute;width:1px}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-style:italic;font-weight:700}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathboldfrak,.katex .textboldfrak{font-family:KaTeX_Fraktur;font-weight:700}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .mathsfit,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{border-collapse:collapse;display:inline-table;table-layout:fixed}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;position:relative;vertical-align:bottom}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;font-size:1px;min-width:2px;vertical-align:bottom;width:2px}.katex .vbox{align-items:baseline;display:inline-flex;flex-direction:column}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{display:inline-flex;flex-direction:row}.katex .thinbox{max-width:0;width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{position:relative;width:0}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{border:0 solid;display:inline-block;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{border-bottom-style:solid;display:inline-block;width:100%}.katex .hdashline{border-bottom-style:dashed;display:inline-block;width:100%}.katex .sqrt>.root{margin-left:.2777777778em;margin-right:-.5555555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.8333333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.1666666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.3333333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.6666666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.4566666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.1466666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.7142857143em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.8571428571em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.1428571429em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.2857142857em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.4285714286em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.7142857143em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.0571428571em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.4685714286em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.9628571429em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.5542857143em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.5555555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.6666666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.7777777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.8888888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.1111111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.3333333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.3044444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.7644444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.4166666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.5833333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.6666666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.8333333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.7283333333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.0733333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.3472222222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.4166666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.4861111111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.5555555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.6944444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.8333333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.4402777778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.7277777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.2893518519em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.3472222222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.4050925926em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.462962963em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.5208333333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.6944444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.8333333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.2002314815em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.4398148148em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.2410800386em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.2892960463em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.337512054em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.3857280617em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.4339440694em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.4821600771em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.5785920926em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.6943105111em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.8331726133em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.1996142719em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.2009646302em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.2411575563em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.2813504823em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.3215434084em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.3617363344em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.4019292605em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.4823151125em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.578778135em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.6945337621em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.8336012862em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;display:block;height:inherit;position:absolute;width:100%}.katex svg path{stroke:none}.katex img{border-style:none;max-height:none;max-width:none;min-height:0;min-width:0}.katex .stretchy{display:block;overflow:hidden;position:relative;width:100%}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{overflow:hidden;position:relative;width:100%}.katex .halfarrow-left{left:0;overflow:hidden;position:absolute;width:50.2%}.katex .halfarrow-right{overflow:hidden;position:absolute;right:0;width:50.2%}.katex .brace-left{left:0;overflow:hidden;position:absolute;width:25.1%}.katex .brace-center{left:25%;overflow:hidden;position:absolute;width:50%}.katex .brace-right{overflow:hidden;position:absolute;right:0;width:25.1%}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{border:.04em solid;box-sizing:border-box}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{border-right:.049em solid;border-top:.049em solid;box-sizing:border-box;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{content:"(" counter(katexEqnNo) ")";counter-increment:katexEqnNo}.katex .mml-eqn-num:before{content:"(" counter(mmlEqnNo) ")";counter-increment:mmlEqnNo}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;left:calc(50% + .3em);position:absolute;text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{padding-left:2em;text-align:left}body{counter-reset:katexEqnNo mmlEqnNo}
</style>
<style>/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.katex-error {
	color: var(--vscode-editorError-foreground);
}
</style>

    </head>
    <body class="vscode-body vscode-light">
        <h1 data-line="0" class="code-line" dir="auto" id="mining-muse-a-moderately-useful-source-exploration" tabindex="-1">Mining MUSE (A Moderately Useful Source Exploration)</h1>
<p data-line="2" class="code-line" dir="auto">This is a different kind of project for Computercraft, one aimed at teaching, by example, what's involved in developing maintainable code. It's a Moderately Useful Source Exploration, MUSE.</p>
<p data-line="4" class="code-line" dir="auto">MUSE is a collection of resources built on the <a href="https://tweaked.cc/" target="_blank"> ComputerCraft <em>mod</em></a> to <a href="https://www.minecraft.net/" target="_blank"> Minecraft </a> written in <a href="http://www.lua.org/" target="_blank"> Lua </a>. It provides a set of capabilities for ComputerCraft turtles and computers (also written in Lua) that make it easy (quite possibly too easy) to mine, farm, and do explorations in Minecraft worlds.</p>
<p data-line="6" class="code-line" dir="auto">Looking about in MUSE, as we'll do here, is a different kind of exploration. It is the exploration into how to develop clean, maintainable code intended for those worlds (as a start). <img src="drawings/00Compost.png" hspace="10" align="right"> Making a mess is easy (quite possibly too easy). The hope that what we're about here is makes it easier to avoid.</p>
<p data-line="8" class="code-line" dir="auto">But why would you want to do that? Because, even if you're working all on your own, looking at what you (and your trusty AI agent) wrought in fevered moments not long past, you just know deep down that it was some rogue AI from another planet that wrote the tangled mess you're facing. And, of course, in the real world, code development is generally something done with others, sometimes a lot of others (and their agents). It's good to play well with those others.</p>
<p data-line="10" class="code-line" dir="auto">Can you just let the agent do it? Of course you can. But then you're still responsible for that possibly hallucinated, and maybe  hallucinogenic potential mess. Better you know what the code looks like that you'll need to maintain.</p>
<p data-line="12" class="code-line" dir="auto">And there's a deeper reason. It has to do with the overall design of what you're responsible for. There are just a lot of broader design choices that are reflected in the code but got decided way before the code was written (whether generated by you or your agent). We'll get to those shortly.</p>
<h2 data-line="14" class="code-line" dir="auto" id="chapter-1---exploring-why-what-what-not-and-how" tabindex="-1">Chapter 1 - Exploring Why, What, What Not, and How</h2>
<div data-line="15" class="code-line" dir="auto"></div>
<br>
<div data-line="17" class="code-line" dir="auto"></div>
<img src="drawings/01CodeNeverLies.png">
<p data-line="19" class="code-line" dir="auto"><em>Mining MUSE</em> is based on the idea of exploration. Just as software development is actually practiced, there's a lot of exploration to do when trying to understand and fix or extend someone else's code (including the mess made by that AI cowboy). What follows in these chapters is an overview of that exploration. But the overview is only the root of a very branchy tree. The interesting stuff is generally found somewhere near the leaves. Where exactly depends on you, your interests, your motivation, your experience. Go as far as seems useful. Go back and look further when that seems right. It's up to you.</p>
<p data-line="21" class="code-line" dir="auto">As you explore, after some looking at some fundamental ideas for maintainable code and the design of a code base, you can use      MUSE to look at some broader design choices:</p>
<ul data-line="22" class="code-line" dir="auto">
<li data-line="22" class="code-line" dir="auto">choosing the right abstractions for your design,</li>
<li data-line="23" class="code-line" dir="auto">dealing cleanly with the inevitable changes to the user interface,</li>
<li data-line="24" class="code-line" dir="auto">considering the issues with persistence over time,</li>
<li data-line="25" class="code-line" dir="auto">making available and managing concurrency,</li>
<li data-line="26" class="code-line" dir="auto">handling errors on a computer in a network far, far away,</li>
<li data-line="27" class="code-line" dir="auto">providing distributed service discovery,</li>
<li data-line="28" class="code-line" dir="auto">establishing remote procedure calls and remote command interfaces,</li>
<li data-line="29" class="code-line" dir="auto">looking at the role of 'little languages" in declarative programming, and finally,</li>
<li data-line="30" class="code-line" dir="auto">deciding whether frameworks (an inversion of control) would be helpful (or not).</li>
</ul>
<p data-line="33" class="code-line" dir="auto">The (HTML) <a href="#links"> links </a> to places in the branchy tree throughout MUSE are a way into the exploration. The materials in the tree describe working examples with, yes, more links, drawings, pictures, and extensively documented code.<a id="links"> <img src="drawings/01Tree.png" hspace="10" align="left"> </a> There's probably as much explanatory text as executable code in the examples. This leads to the usual tension between the ideas of <a href="https://en.wikipedia.org/wiki/Literate_programming" target="_blank"> <em>literate programming</em> </a> and the, all too correct, understanding that <a href="https://www.linkedin.com/posts/johncrickett_code-never-lies-comments-sometimes-do-activity-7307389003735924736--ugV" target="_blank"> comments (sometimes) lie</a>. If you need to extensively comment code, as we do to meet our goals here, you're taking on an extra burden to keep the comments true to the code (which never lies). There is a benefit though of doing the work of extensive commenting: you're explaining the code (especially the <em>whys</em> of the code) to a virtual partner when a real life one, quite possibly the you from another planet, is not available. Often enough while explaining, you'll see something you might otherwise have missed.</p>
<p data-line="35" class="code-line" dir="auto">Explore the links in the code body to go on excursions further (and further) afield. Feel free to wander, skimming as you go, and then return for more extensive explorations as seems best. Early chapters will generally go into detail omitted in later ones so if you skip chapters, you may need to go back a bit to go forward.<br></p>
<p data-line="37" class="code-line" dir="auto">So then, here we are, looking at whether to knock about in that tree. Is it worth the time? For that, let's examine what we're trying to do. Here it is:</p>
<div data-line="38" class="code-line" dir="auto"></div>
<div style="background-color: lightgoldenrodyellow">
<ul data-line="40" class="code-line" dir="auto">
<li data-line="40" class="code-line" dir="auto">
<p data-line="40" class="code-line" dir="auto"><strong>Why this?</strong> The intent is to provide an exploration of how to write <a href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882" target="_blank"> clean code </a>expected to be read (so it can more easily be maintained) and, as as part of that maintenance, evolved and extended.</p>
</li>
<li data-line="42" class="code-line" dir="auto">
<p data-line="42" class="code-line" dir="auto"><strong>What is this?</strong> A tutorial of sorts using just the code needed to implement a particular set of ComputerCraft capabilities with Lua scripting. Ease of code maintenance over the long term is the chief goal of the design of that code. MUSE is a bit strange in that it aims to be a professional piece of development for a problem domain which is, after all, just a game. The game is the bit of sugar that, hopefully, helps the medicine go down.</p>
</li>
<li data-line="44" class="code-line" dir="auto">
<p data-line="44" class="code-line" dir="auto"><strong>What is this not?</strong> It does not pretend to be a <a href="https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/6-005-software-construction-spring-2016/readings/" target="_blank"> comprehensive review of software fundamentals </a>, <a href="https://gustavus.edu/mcs/max/concrete-abstractions-annotated-toc/" target="_blank"> computer programming </a> or, the range of ideas for <a href="https://mitp-content-server.mit.edu/books/content/sectbyfn/books_pres_0/6515/sicp.zip/index.html" target="_blank"> the design and use of computer languages</a>. (Here's a <a href="https://news.ycombinator.com/item?id=2115756" target="_blank"> tour guide </a> you might find useful.) It's also not likely to be useful as someone's <a href="https://nostarch.com/codingwithminecraft" target="_blank"> very first exposure </a> to just getting some code to run. There are <a href="https://www.youtube.com/watch?v=wrUHUhfCY5A" target="_blank">videos</a> and <a href="https://www.youtube.com/watch?v=DSsx4VSe-Uk" target="_blank">other</a> on-line <a href="https://ccf.squiddev.cc/topic/15033-computer-basics-i.html" target="_blank"> resources</a> as well. (But do come back once that's behind you.) A more serious limitation is the issue of scale. MUSE is not millions of lines of code created by scores of developers. The hope is that by exploring MUSE you will find ideas and approaches that will prove useful if you ever need to work in that necessarily more constrained environment.</p>
</li>
<li data-line="46" class="code-line" dir="auto">
<p data-line="46" class="code-line" dir="auto"><strong>How is this done?</strong> By exposing in some detail the design ideas underlying a particular body of code, namely the code for MUSE.</p>
</li>
<li data-line="49" class="code-line" dir="auto">
<p data-line="49" class="code-line" dir="auto"><strong>What's next?</strong> Reading on to review the design and implementation of MUSE.</p>
</li>
<li data-line="51" class="code-line" dir="auto">
<p data-line="51" class="code-line" dir="auto"><strong>And after that?</strong> Setting up a environment allowing modification of the code base and trying it out in ComputerCraft execution. That's described in an <a href="#appendix-musecraft---running-muse" target="_blank"> <em>appendix</em></a>.</p>
</li>
</ul>
<div data-line="52" class="code-line" dir="auto"></div>
</div>
<h2 data-line="54" class="code-line" dir="auto" id="chapter-2---moving-turtles-functions-state-and-history" tabindex="-1">Chapter 2 - Moving Turtles: Functions, State, and History</h2>
<p data-line="56" class="code-line" dir="auto">One of the first things to think about when designing a body of code is how that body of code might be organized.  MUSE is organized around the idea of what we'll call a <em>module</em>. Each module is a file that includes at least one <a href="https://en.wikipedia.org/wiki/Library_(computing)" target="_blank"> <em>library</em>.<img src="drawings/02Bookshelf.png" hspace="10" align="right"></a> (A module may contain additional libraries sharing some internal implementations.) In what follows we'll explore the idea of libraries, likely the most important idea in the exploration of MUSE, and show an example of how they might be organized for readers and maintainers.</p>
<p data-line="58" class="code-line" dir="auto">Library interfaces set the boundaries of a library.  They indicate what can be relied upon by the users of a library without needing to know about its implementation. In this way, they allow the effects of library maintenance to be contained within a library. The right organization of library structure is an important way of easing maintenance. Your first attempt, done in haste, might not be right. Expect penitential experiences <a href="https://en.wikipedia.org/wiki/Code_refactoring" target="_blank"> while refactoring code </a> that was written in a hurry. <em>Code in haste, repent at leisure.</em> Sometimes, it's best to just step away for a bit and just think about a design (or debug) issue. <em>Don't just do something, stand there.</em> Really. Remember that <a href="https://medium.com/@ronaldssebalamu/the-wage-of-sin-is-debugging-ron-jeffries-12ffad9600ad" target="_blank"> the wages of sin is debugging</a>. Otherwise you will pay... as will your project's ancestors and dependents. Rather, if you think a bit first, often a cleaner approach to the problem will emerge. If the cleaner approach solves more than one problem cleanly, it stands a good chance of being more maintainable.</p>
<p data-line="60" class="code-line" dir="auto">As we've said, libraries have interfaces. MUSE introduces a way of describing interfaces and checking their use by adding annotations as comments to the source code. As a dynamically typed language, Lua provides flexible and expressive richness for implementation and the corresponding opportunities for run time errors that might only show up (expensively) in fielded code. Describing interfaces and checking their use is a way to deal with some of these unfortunate opportunities as part of development. We do this with <a href="https://minerbadd.github.io/CodeMark/Annotations.html#type" target="_blank"> CodeMark Annotations</a> documented in their own right. It might be best just to know for now that CodeMark documentation is available if needed. The descriptive text for the code we'll explore will be enough to understand each interface (although in a less concise form).</p>
<p data-line="62" class="code-line" dir="auto">The second idea we want to think about as we begin our exploration deals with the management of <a href="https://en.wikipedia.org/wiki/State_(computer_science)" target="_blank"> <em>state</em> </a>. The most common ways to design code involve the concept of state, elements with values that are changed <a href="http://lua-users.org/wiki/ImmutableObjects" target="_blank"> (<em>mutated</em>) </a> during code execution. Mismanagement of state, especially inappropriate exposure of state, is often the root problem for a lot of code that is difficult to maintain. A radical approach to the problem of state is to (mostly) do without it. There are <a href="https://en.wikipedia.org/wiki/Purely_functional_programming" target="_blank"> purely functional languages</a> like <a href="https://www.seas.upenn.edu/~cis1940/spring13/lectures/01-intro.html" target="_blank"> Haskell </a> that go there. Lua doesn't.</p>
<p data-line="64" class="code-line" dir="auto">The third idea we'll explore is to look at some of the ways Lua functions can be used to structure code cleanly to manage state and more. This idea is not at all limited to Lua. Lua is just one example of a language where functions play such an important part in code structure to do this (and a lot more).</p>
<p data-line="66" class="code-line" dir="auto">There's a lot of design power in an approach that exploits functions as just another type in a language. MUSE takes advantage of that. There's a lot of maintainance power in basing a design on tables of functions and other controls to direct the work done as requirements evolve. MUSE makes use of  that approach. There's also a lot of unavoidable complexity in dealing with error conditions that crop up even in the relatively friendly environment of a game involving (simulated) networks. All this is to say (as we've said) that the implementations we'll look at are not what you'd expect as the very first exposure to just getting some code to run.</p>
<p data-line="68" class="code-line" dir="auto">The two libraries we'll explore in this chapter are foundational in two ways. As you might expect, they expose function interfaces that many other libraries depend on. But just as foundational, they define common data structures, the turtle's <code>situation</code> and the (named) <code>place</code> in the Minecraft world where a turtle (or the player) might be found. Many MUSE libraries work with these structures</p>
<p data-line="70" class="code-line" dir="auto">With that understanding, it's time to climb about in that tree we spoke of. Try clicking the following link to explore the implementation of the <a href="code/lib/motion.html" target="_blank"> <code>lib/motion</code> </a> module. Then look at <a href="code/lib/places.html" target="_blank"> <code>lib/places</code></a>,  its companion. <a href="code/lib/motion.html" target="_blank"><img src="drawings/01Tree.png" hspace="10" align="left"> </a>Explore the structure of the libraries in these modules, the issues they raise in dealing cleanly with state, and some of the ways to use Lua functions to structure code. The exported interfaces for <a href="docs/lib/motion.html" target="_blank"> <code>lib/motion</code>
</a> and <a href="docs/lib/places.html" target="_blank"> <code>lib/places</code> </a> might help you to see where you've been climbing. (Just to start out, it might be better to just scan summaries for now. They'll mean more to you after spending some time on implementations.)</p>
<p data-line="73" class="code-line" dir="auto">These libraries rely on <code>lib/core</code>, a collection, as you might expect, of generally useful (core) functions. For now, just look at the exported <a href="docs/lib/core.html" target="_blank">interfaces</a> for that library. We'll discuss the implementations of these functions as needed.</p>
<p data-line="75" class="code-line" dir="auto">As you finish your exploration of <a href="code/lib/motion.html" target="_blank"> <code>lib/motion</code></a>, take some time to consider how to test it. For MUSE, the <a href="https://https://en.wikipedia.org/wiki/Unit_testing" target="_blank"> <em>unit tests</em> </a> for MUSE libraries are incorporated in the <code>tests</code> directory. (In some <a href="https://en.wikipedia.org/wiki/Test-driven_development#:~:text=Test%20Driven%20Development%20(TDD)%20is,leading%20to%20more%20robust%20software" target="_blank"> practices</a>, such unit tests are expected to be written before coding. You might want to try that.)</p>
<p data-line="77" class="code-line" dir="auto">As part of testing, MUSE includes rudimentary support for
<a href="https://en.wikipedia.org/wiki/Regression_testing " target="_blank"> regression testing</a> for sets of unit tests in the <a href="code/lib/check.html" target="_blank"> <code>lib/check</code></a> library. In general, MUSE doesn't make use of <a href="https://en.wikipedia.org/wiki/Object-oriented_programming" target="_blank">objects</a> since it seemed unnecessary to include them in the design. But a particular (limited) kind of <em>objects</em> did seem a good fit for <code>lib/check</code></p>
<p data-line="80" class="code-line" dir="auto">When you're ready, go on to the next chapter where there'll be ideas about what to expose and what to hide in a design and how to build a simple and easily maintainable command line user interface.</p>
<p data-line="82" class="code-line" dir="auto"><a id="Chapter3"></a></p>
<h2 data-line="83" class="code-line" dir="auto" id="chapter-3---choosing-abstractions-tables-making-functions-commands-thin" tabindex="-1">Chapter 3 - Choosing Abstractions, Tables Making Functions, Commands Thin</h2>
<p data-line="84" class="code-line" dir="auto"><a href="https://en.wikipedia.org/wiki/Information_hiding#:~:text=In%20computer%20science%2C%20information%20hiding,the%20design%20decision%20is%20changed." target="_blank"> <em>Information hiding</em>  </a>is an important part of what a library does. The choice of what to expose as an interface is the choice of what to hide. One aspect of choosing what (detail) to hide is choosing the abstractions to create. Exposing the wrong detail gets in the way of delivering an evolving yet maintainable system. Thus, the task of design is often about exposing the right abstractions.</p>
<p data-line="86" class="code-line" dir="auto">For MUSE, some abstractions are obvious. They closely relate to what's in the game, our <em>problem domain</em>, and have fairly intuitive expression in the <em>solution domain</em> that we're <a href="https://shahworld.wordpress.com/2015/09/22/what-is-problem-domain-and-solution-domain/" target="_blank"> building</a>. For changes in the position and orientation of a turtle, the right abstractions might expose interfaces for movement in the four cardinal directions ("north", "south", "east", and "west") rather than relative directions ("right" and "left"). The <a href="docs/lib/motion.html" target="_blank"> <code>lib/motion</code> </a> library exposed these abstractions for movement.</p>
<p data-line="88" class="code-line" dir="auto"><img src="drawings/03Compass.png" align="right" hspace="10"></p>
<p data-line="90" class="code-line" dir="auto">The  <a href="code/lib/turtle.html" target="_blank"> <code>lib/turtle</code></a> library extends this abstraction consistently with the other interesting things turtles can be made to do. The consistency itself helps in maintenance. As we said, ComputerCraft's primitives deal with turns "right" and "left". They deal separately with those other things turtles can do in terms of "forward", "up", and "down".  A useful set of abstractions would be to hide all this detail and expose turtle interfaces uniformly in terms of six directions: the four cardinal and the two vertical directions (while still allowing <code>forward</code>). <a href="code/lib/turtle.html" target="_blank"> <img src="drawings/03Tree.jpg" hspace="10" align="left"> </a></p>
<p data-line="92" class="code-line" dir="auto">There's a pretty long list of turtle operations that would need fitting into this abstraction. The fitting is so repetitive that it lends itself to representation as a table. There's a couple of <em>maker functions</em> executed when <code>lib/turtle</code> is loaded. They make the functions that <code>lib/turtle</code> exports. Each of those exported turtle operation functions is then exposed as a table indexed by <code>direction</code>.</p>
<p data-line="94" class="code-line" dir="auto">Functions making tables is the <em>dog bites man</em> story (it's not exactly news that <em>functions make tables</em>). With a little license, this is the  <em>tables make functions</em> story. It's a small step toward a <a href="https://en.wikipedia.org/wiki/Declarative_programming" target="_blank"> declarative programming </a>style. Larger ones to follow. For now, look at the <code>lib/turtle</code> <a href="code/lib/turtle.html" target="_blank"> implementation </a> to see how to have yet more fun with functions.</p>
<p data-line="96" class="code-line" dir="auto">Another detail needing abstracting is the notion of what's in which <code>slot</code> of a turtle's  <a href="code/lib/turtle.html#inventory" target="_blank"> inventory</a>. What's where exactly is something worth hiding. What we generally just want to know is whether the turtle's <code>inventory</code> includes certain items. Or better, whether it includes certain kinds, <code>categories</code>, of items.  These might be, for example,  <code>fuels</code>, <code>stones</code>, or <code>ores</code>. You might want to know about whether a turtle's got stones but not care what kind exactly. A category could be items useful as <code>fills</code> or the kinds of <code>dirt</code>. We might be more interested in the total fuel energy available to a turtle rather than any specific kind of fuel.</p>
<p data-line="98" class="code-line" dir="auto">Finally, <code>lib/turtle</code> also abstracts <a href="code/lib/turtle.html#unblock" target="_blank"> dealing with some of the difficulties </a> turtles face when attempting to move to a position. Hiding the detail of dealing with obstacles presents a simpler notion of movement.</p>
<p data-line="100" class="code-line" dir="auto">With all these changes, <code>lib/turtle</code> has superseded the ComputerCraft definition of a turtle. Behold, all turtles are made new. (At least if you load <code>lib/turtle</code>.) There are two clients of the born again turtle that we'll discuss  next: <code>lib/roam</code> and <code>lib/task</code>. First <code>lib/roam</code>.</p>
<div data-line="102" class="code-line" dir="auto"></div>
<a id="roam">
</a><p data-line="104" class="code-line" dir="auto"><a id="roam">The <code>lib/roam</code> </a><a href="code/lib/roam.html" target="_blank"> library </a> provides yet more movement extensions for our turtles:</p>
<ul data-line="106" class="code-line" dir="auto">
<li data-line="106" class="code-line" dir="auto">
<p data-line="106" class="code-line" dir="auto"><em><strong>try again strategies</strong></em>  using permutations to look for ways around blockages,</p>
</li>
<li data-line="108" class="code-line" dir="auto">
<p data-line="108" class="code-line" dir="auto"><em><strong>going to a <code>place</code></strong></em> (as well as specified xyz coordinates) with <code>to</code></p>
</li>
<li data-line="110" class="code-line" dir="auto">
<p data-line="110" class="code-line" dir="auto"><em><strong>turtle side support</strong></em> for following the <code>player</code> around (as befits, say, a squire turtle) with <code>come</code>, and</p>
</li>
<li data-line="112" class="code-line" dir="auto">
<p data-line="112" class="code-line" dir="auto"><em><strong>a very tiny language</strong></em> to chain together commands to move a turtle piecewise in all those abstracted directions with <code>go</code>,</p>
</li>
</ul>
<p data-line="114" class="code-line" dir="auto">All this is done using both the abstractions of <code>lib/turtle</code> and the primitives of <code>lib/motion</code>. The library also shows a way to design a more maintainable <a href="https://en.wikipedia.org/wiki/Command-line_interface" target="_blank">  <em>Command Line Interface</em>  </a>(CLI) based user control facility.
<a href="code/lib/roam.html" target="_blank"> <img src="drawings/03ATree.jpg" hspace="20" align="left"> </a>
The <code>lib/roam</code> library centralizes error handling, safety checks on turtle dead reckoning, and simulated blockage testing for all the commands it supports. It does all this in its CLI <a href="code/lib/roam#op.html" target="_blank">dispatch </a> mechanism, one part of keeping command code thin, a virtue eagerly to be sought.</p>
<p data-line="118" class="code-line" dir="auto"><a id="UI"></a>
Managing the inevitable and ongoing changes to the user interface is an important issue for maintainable code. MUSE, with commendable virtue, keeps the actual UI code "thin" in the command programs creating the UI. All the hard stuff is in the support libraries. Changes to the UI itself are generally pretty easy. That's good because experience with a UI is the most likely generator of reasons to change it. <a href="https://en.wikipedia.org/wiki/Command-line_interface" target="_blank"> <img src="drawings/03CLI.png" align="right" vspace="10" hspace="10"> </a></p>
<p data-line="121" class="code-line" dir="auto"><em>(We have it a bit easier since the user interface for MUSE is just a CLI. The commands are simple text inputs to the <a href="https://www.computercraft.info/wiki/CraftOS" target="_blank"> CraftOS</a> command line. The design issues for a <a href="https://en.wikipedia.org/wiki/Graphical_user_interface" target="_blank"> graphical user interface, a GUI</a> are the subject of a whole other exploration.)</em></p>
<p data-line="123" class="code-line" dir="auto">A desire to ease testing is a second motivation for minimizing the work of the command itself. It's easier to test function interfaces than creating the testing facilities that drive simulated user interactions. Because of this, almost all of the work of providing MUSE CLIs is done by libraries supporting the commands. More elaborate command interfaces (including GUIs) would require more elaborate testing support systems. Sometimes project goals demand such interfaces. They would be distractions for MUSE.</p>
<p data-line="125" class="code-line" dir="auto">The function supporting <code>go</code> is a very <a href="http://staff.um.edu.mt/afra1/seminar/little-languages.pdf" target="_blank"> <em>little language</em></a>. We'll develop a more elaborate one later on in the exploration. But here's a <a href="code/lib/roam.html#go" target="_blank"> starter </a> to look at for now.</p>
<p data-line="127" class="code-line" dir="auto">The functions supporting <code>to</code> and <code>come</code> try <a href="https://en.wikipedia.org/wiki/Permutation" target="_blank"> permuations </a> in the order of each of the three axes of movement to get around blockages. There's an iterator provided by <code>core.permute</code>.</p>
<p data-line="129" class="code-line" dir="auto">Lua has a <a href="https://www.lua.org/doc/sblp2005.pdf" target="_blank"> one pass compiler</a>. Functions build on each other from the beginning of the file to the end. The tree image <a href="code/lib/roam.html" target="_blank"> links </a> to the beginning of the file. Alternatively, you may want to follow the code backward toward the beginning through the support for <a href="code/lib/roam.html#go" target="_blank"> <code>go</code> </a> and <a href="code/lib/roam.html#to" target="_blank"> <code>to</code> </a> and then look at <a href="code/lib/roam.html#come" target="_blank"> <code>come</code> </a> to see how this is done. Or just read it as written by clicking the tree.
<br><br>
<a id="task"></a>
You might have been driven to abstraction by what we've been going on (and on) about. But it's the new and improved turtle that lets us build the <a href="code/lib/task.html" target="_blank"> <code>lib/task</code> library</a>. It supports a CLI for low level turtle tasks in terms of those abstracted directions. Some, like <code>dig</code>, involve chewing gum while walking (or whatever it is that turtles do in such moments). These use the <code>step</code> closures from <code>lib/motion</code> to do the work, as for <code>dig</code>, one small step (for a turtle) at a time. The implementation for each of those low level turtle operations in <code>lib/task</code> uses the table (indexed by <code>direction</code>) that was made for that operation by <code>lib/turtle</code>. Oh, the things a turtle can do.</p>
<p data-line="134" class="code-line" dir="auto">There's a <a href="code/lib/task.html#movement" target="_blank">technique </a> in the <code>lib/task</code> implementation that folds particular kinds of movement vectors into a (scalar) <code>direction</code> for that vector. It takes advantage of a property of the sequence of some such vectors that they only make changes in one axis at a time. It's the same sort of thing as done in <a href="code/lib/map.html#cardinal" target="_blank"> <code>lib/map</code></a> (which we'll come to soon) to settle on a compass direction. You may find use for the technique in this or other kinds of folding.</p>
<p data-line="136" class="code-line" dir="auto">A similar pattern as described for <code>lib/roam</code> is used for the implementation of this CLL (CLI support library). There's little need to see how, in particular, <code>lib/task</code> does this unless to see another example of how thin CLI support might be built. But follow the <a href="code/lib/task.html#dispatch" target="_blank"> link </a> if you're interested.</p>
<p data-line="138" class="code-line" dir="auto">If all you're looking for right now is how these libraries fit into the overall design, here are links to the interfaces for <a href="docs/lib/turtle.html" target="_blank"> <code>lib/turtle</code> </a>,  <a href="docs/lib/roam.html" target="_blank"><code>lib/roam</code></a>, and <a href="docs/lib/task.html" target="_blank"> <code>lib/task</code> </a>. Working on code this way is a good strategy to have available to you. Sometimes in coming to grips with a body of code written by that cowboy agent from another planet, just understanding the library interfaces for what's been exhumed can be helpful.</p>
<p data-line="140" class="code-line" dir="auto"><a href="drawings/03Abstractions.pdf" target="_blank"><img src="drawings/03Abstractions.png" align="right" hspace="10"></a></p>
<p data-line="142" class="code-line" dir="auto">Additionally, there's a <a href="drawings/03Abstractions.pdf" target="_blank"> drawing</a>, the one that's thumbnailed here, showing how these MUSE libraries work together with what's gone before. Together they form and make use of (wait for it) increasing levels of abstraction for MUSE.</p>
<p data-line="144" class="code-line" dir="auto">When that's done come back here to explore how to establish state that persists across <a href="https://en.wikipedia.org/wiki/Session_(computer_science)" target="_blank"> <em>sessions</em></a>, how to deal with state distributed over a network, and how error handling works in network environments.
<br></p>
<p data-line="147" class="code-line" dir="auto"><a id="Chapter4"></a></p>
<h2 data-line="148" class="code-line" dir="auto" id="chapter-4---persistence-concurrency-remote-errors" tabindex="-1">Chapter 4 - Persistence, Concurrency, Remote Errors</h2>
<p data-line="149" class="code-line" dir="auto">This chapter is less about how to write code in general. We've pretty much finished flogging that particular horse. This chapter (and pretty much each that follow) is more about how to provide some important mechanisms. They're the ones that you may need to design (or understand how someone else did).</p>
<p data-line="151" class="code-line" dir="auto">MUSE needs to deal with networked computers (like turtles and pocket computers). They'll be operating on distributed persistent state. The operations may throw <a href="https://en.wikipedia.org/wiki/Exception_handling_(programming)" target="_blank"> exceptions </a> to signal errors. We'll discuss in a bit how to deal with them. But first, persistent state itself.</p>
<p data-line="153" class="code-line" dir="auto">The persistent state is stored in <a href="https://en.wikipedia.org/wiki/Non-volatile_memory" target="_blank"> <em>non-volatile memory</em>  </a> represented in ComputerCraft as disk storage local to each networked computer. <a id="persistence"></a>Most commonly, such persistence requires that the mutable (changeable) elements in computer memory be <a href="https://en.wikipedia.org/wiki/Serialization" target="_blank"> <em>serialized</em></a>, that is turned into <a href="https://www.lua.org/pil/2.4.html" target="_blank"> <em>strings</em> </a> that can later be deserialized in order to store the serialized elements back into computer memory to do operations on them there.</p>
<p data-line="155" class="code-line" dir="auto">Supporting <em>networked</em> distributed state is done using these same serialization facilities to send strings over the network. These strings are then deserialized when they are received by the target computer. All this (and much more) is done by the MUSE <code>lib/core</code><a href="code/lib/core.html#serialize" target="_blank"> library</a> .</p>
<p data-line="157" class="code-line" dir="auto">As promised, this chapter also deals with remote error handling. Exceptions <a href="https://en.wikipedia.org/wiki/Exception_handling_(programming)" target="_blank"> thrown </a> by remote operations on remote computers to signal errors need to be caught on those computers and dealt with so that the remote computers remain available to handle future commands. Error information then needs to be passed back over the network to let the remote caller know what blew up and figure out what to do about it. Check out the <code>lib/map</code> <a href="code/lib/map.html#op" target="_blank"> dispatch </a> and the <code>lib/core</code> <a href="code/lib/core.html#pass" target="_blank"> handler </a> to see how this works. Then follow a couple of the <a href="code/lib/map.html#commands" target="_blank">links </a> provided there to look at the actual command programs. It's another, more developed, example of keeping the CLI thin. We'll see later how the same dispatch is used whether a command is invoked locally by the player for the player or the command arrives over the network for a turtle.</p>
<p data-line="159" class="code-line" dir="auto"><img src="drawings/03Computers.png" align="left" hspace="10">Finally this chapter deals with the issues raised by <a href="https://en.wikipedia.org/wiki/Concurrent_computing" target="_blank"> concurrency</a>. In-game, all of the simulated computers including those for turtles and players are, of course, supported by one real computer running the game. This is mostly transparent to MUSE except for the need to yield control from one of these simulated computers to the real one from time to time so other simulated computers get their turn. Turtles and other in-game computers then need to re-acquire control to handle what's been happening to them.</p>
<p data-line="161" class="code-line" dir="auto">Lua provides and ComputerCraft uses <a href="https://en.wikipedia.org/wiki/Coroutine#:~:text=Coroutines%20are%20computer%20program%20components,iterators%2C%20infinite%20lists%20and%20pipes." target="_blank"> <em>coroutines</em> </a> for <a href="https://en.wikipedia.org/wiki/Cooperative_multitasking" target="_blank"> <em>cooperative multitasking</em></a>. MUSE programs yield control implicitly whenever there is a turtle movement or when waiting for a network event. They yield control explicitly through ComputerCraft <code>os.sleep</code> calls. Yielding control either implicitly or explicitly allows, for example, network operations and <a href="https://ccf.squiddev.cc/topic/3088-how-to-guide-gps-global-position-system.html" target="_blank"> GPS </a> calculations by other simulated computers to proceed. MUSE handles network operation events using ComputerCraft's  <a href="https://tweaked.cc/module/parallel.html" target="_blank"> <code>parallel.waitForAny</code> </a> function. More elaborate use of coroutines <a href="https://ccf.squiddev.cc/topic/25670-bbs-guide-to-coroutines/" target="_blank"> might have been considered</a>. MUSE keeps it simple.</p>
<p data-line="163" class="code-line" dir="auto">Cooperative multitasking is a simple model that works as long as the multitasking is actually cooperative. Control is relinquished to allow other operations to proceed in a timely way but only when it's not a problem to do so, that is, as long as  <a href="https://en.wikipedia.org/wiki/Data_consistency" target="_blank"> <em>data consistency</em>  </a> is preserved.</p>
<p data-line="165" class="code-line" dir="auto">Here's an data consistency example: a network message is received, data structures de-serialized, associated changes made in other data structures, and then, perhaps, serialized and stored. If the data structures or storage are visible to other operations, all, really <em>completely all</em>, of this needs to accomplished by a cooperating (simulated) computer when it has control or none of this. If it does any of this, it needs to do it all before starting anything else. Doing just part leaves inconsistent state laying around to make trouble at some later time when it's really hard to figure out what went wrong.</p>
<p data-line="167" class="code-line" dir="auto">In MUSE there is no shared mutable state between computers. It takes a network operation (applied all or none as above) to change state in another simulated computer. There's no need for the complexity of <a href="https://en.wikipedia.org/wiki/Critical_section" target="_blank"> <em>critical sections</em> </a> and the associated opportunities for error. There are, indeed, well developed <a href="https://clojure.org/about/concurrent_programming" target="_blank"> <em>language models for concurrency</em></a> to handle concurrency in a maintainable way. But if you can meet your design goals, your work will be simpler and more maintainable if you restrict the need to go there.</p>
<p data-line="169" class="code-line" dir="auto">In MUSE, all the simulated computers do share a ROM image but this is, by definition, immutable, read only within a session. ComputerCraft makes no guarantees about what happens if there's an out-of-game change of ROM during a session. (There are other considerations for the changes in interfaces that deal with networked persistent data structures.  We'll discuss these later.)</p>
<p data-line="171" class="code-line" dir="auto">If there's one design idea for maintainable code in all the above, it's to seek to keep it simple. Design goals for a project may not allow the simple approach just described for run time organization. There might be tools to mitigate risks inherent in more complicated organizations. They might work. But perhaps you can find a way to isolate complexity in the design so that most of what is developed can rely on simple assumptions about what happens at run time.</p>
<p data-line="173" class="code-line" dir="auto"><a href="code/lib/map.html" target="_blank"><img src="drawings/04Tree.jpg" hspace="10" align="left"></a> <img src="drawings/04Persistence.png" align="right" hspace="10"> 
A design handling persistence, management of distributed state, and remote error handling is demonstrated by the <a href="code/lib/map.html" target="_blank"> implementation </a> and <a href="docs/lib/map.html" target="_blank"> interface </a> of the <code>lib/map</code> library.</p>
<p data-line="176" class="code-line" dir="auto">The library is built on the <a href="code/lib/motion.html" target="_blank"> <code>lib/motion</code> </a> and <a href="code/lib/places.html" target="_blank"> <code>lib/places</code> </a> libraries we've already looked at. Here's the <a href="docs/lib/motion.html" target="_blank"> interface </a> for <code>lib/motion</code>, the <a href="docs/lib/places.html" target="_blank"> interface </a> for <code>lib/places</code>, and a <a href="drawings/04Persistence.pdf" target="_blank"> drawing </a>showing how these libraries form the foundation for MUSE. We'll add more libraries to this drawing as we continue our explorations.</p>
<p data-line="178" class="code-line" dir="auto">There's an operation in <code>lib/map</code> that needs noting. It's there for a reason we'll get to downstream. However it needs saying now that the <a href="code/lib/map.html#chart" target="_blank"> <code>chart</code></a> operation is one of those things your parents might have warned you about. (I suppose it depends on the parents.) It's almost a cartoon for a big, gaping, really scary security hole. Invoking it loads and executes a file in the <code>charts</code> directory. Which could do anything that a ComputerCraft computer could do.</p>
<p data-line="180" class="code-line" dir="auto">Now, to be sure, here be no nuclear reactors. More to the point, as someone creating the code for these computers, you've already been empowered to do anything with a ComputerCraft computer that it can do. Nonetheless, if you're tempted to do what I did and do it in the real world, rather than what I said you shouldn't, think again. It might be appropriate. Or not.</p>
<p data-line="182" class="code-line" dir="auto">With parental warnings duly noted (and  forgotten), we'll see in the next chapter, how remote CLIs are provided through a <a href="https://en.wikipedia.org/wiki/Remote_procedure_call" target="_blank">  <em>remote procedure call</em>  </a> (RPC) that uses the local CLI dispatch we've just been exploring to command remote computers over the network.
<br>
<a id="Chapter5"></a></p>
<h2 data-line="185" class="code-line" dir="auto" id="chapter-5---distributed-service-discovery-remote-procedure-calls-and-clis" tabindex="-1">Chapter 5 - Distributed Service Discovery, Remote Procedure Calls and CLIs</h2>
<p data-line="186" class="code-line" dir="auto">This chapter looks at systems with distributed operations on distributed state. The principle mechanisms considered are distributed name servers to discover providers of available services and remote procedure calls (RPCs) to make use of those services.</p>
<p data-line="188" class="code-line" dir="auto">An RPC in a <a href="https://en.wikipedia.org/wiki/Client%E2%80%93server_model" target="_blank"> <em>client-server model</em>  </a> lets (ahem) clients get services from, well, servers. For MUSE, the client is generally the player's pocket computer. The servers are turtles perhaps with specific roles for farming, mining, or logging.  The roles are established by ComputerCraft computer labels in an area: <code>farmer</code>, <code>miner</code>, and <code>logger</code>.</p>
<p data-line="190" class="code-line" dir="auto">The <code>rover</code> is a general purpose worker acting as something like the squire of the <code>player</code> going wherever the player goes. The other turtles, specialized <code>landed</code> workers, stay in the place they work, a <code>site</code>. The <code>player</code> may establish other sites with other sets of landed workers. The landed worker turtles are equipped with tools appropriate to their specific role.</p>
<p data-line="192" class="code-line" dir="auto">RPCs are directed to turtles as specified by their role. ComputerCraft, of course, has no notion of roles: all it knows are computer IDs (numbers) and computer labels (strings). Its networking is tied to numbers, sequentially assigned as computers are brought into the game. If MUSE operations were based on these numbers, they would be subject to a dependency that's unwieldy to manage and therefore fragile in practice. (Stuff would break.) We need names, not numbers, for the computers in our network that have roles.</p>
<p data-line="194" class="code-line" dir="auto">As we've said, roles are tied to labels. What's left for us is to find a way to discover which names as roles are associated with which numbers. <img src="drawings/05Farmer.png" align="left" hspace="10" vspace="5">This could be done by a task done whenever a player brings a new computer into the game. There could be a table associating names and numbers updated by such a task and kept consistent (and persistent) for all computers. We've already seen with <code>lib/places</code> how keeping names for new things (like <code>places</code>) consistent and persistent throughout the network might be done. Systems have been built this way. MUSE assumes a single player. Nothing happens to turtles "in the meantime" without that player having directed it to happen so, strictly speaking, this approach, based on consistent and persistent mappings could work. (Turtles are really hard for hostile mobs to destroy.)</p>
<p data-line="196" class="code-line" dir="auto">Because it's useful to consider, MUSE implements a a different approach that does not count on managing distributed persistent mappings. Associations between names (roles at a site) and numbers (computer IDs) are discovered by a distributed discovery service, <code>DDS</code>, during system startup to reflect the state of the system however it's been changed.</p>
<p data-line="198" class="code-line" dir="auto">Here's how it works. Roles and sites are established when Computercraft starts up a simulation. When that happens, <a href="code/daemons/.start.html#dds" target="_blank"><code>.start</code> </a>, run at startup, executes <a href="code/lib/dds.html#hosts" target="_blank"><code>dds.hosts</code></a>. This gets the computer <code>ID</code> for each sited role (saved by Computercraft as a computer <code>label</code>) and sends the pair to each computer that has run <code>dds.hosts</code>.</p>
<p data-line="200" class="code-line" dir="auto">At some earlier time, MUSE turtles and the player's pocket computer were assigned roles at their site (as computer labels). This is done by running the <a href="code/programs/join.html" target="_blank"> <code>join</code></a> command which invokes <a href="code/lib/dds.html#join" target="_blank"> <code>dds.join</code></a>. The current site is established by the <a href="code/programs/site.html" target="_blank"> site </a> command implemented by <a href="code/lib/map.html#sited"> <code>map.site</code></a>.</p>
<p data-line="202" class="code-line" dir="auto">We need to note that name servers come in different flavors with different capabilities. The MUSE distributed discovery service, <code>DDS</code>, is only a distant cousin of one real world system, the <a href="https://en.wikipedia.org/wiki/Domain_Name_System" target="_blank"> Domain Name System (DNS)</a>. DNS also basically associates names with numbers. But it deals with millions of computers managed with the barest minimum of coordination over the entire world. Our little DDS does not begin to consider such scale or distribution of control. However it does model approaches to the sort of <a href="https://en.wikipedia.org/wiki/Service_discovery" target="_blank"> service discovery </a> provided for small scale home or local office networks.</p>
<p data-line="204" class="code-line" dir="auto">Given a way to associate names wth numbers with <code>DDS</code>, we can provide a way to get a service request from a client to a server. The other part of what is needed is a way to actually provide the service. That's a job for Remote Procedure Call, an action hero you may (or may not) have heard of.</p>
<p data-line="206" class="code-line" dir="auto">The design of the MUSE RPC makes use of MUSE <a href="code/lib/core.html#serialize" target="_blank"> serialization </a> and Lua's <code>load</code> facilities to package and unpackage procedure arguments for network transmission and reception. As a development exercise, this could be generalized to use language independent formatting such as <a href="https://en.wikipedia.org/wiki/JSON" target="_blank"> JSON </a>. There are a number of such <a href="https://www.google.com/search?q=json+lua" target="_blank"> implementations</a>.</p>
<p data-line="208" class="code-line" dir="auto">But that seemed to be a distraction from our goals. Even so, supporting our goals, the design is more general than is strictly needed. As we'll see, it is built to handle environments that could be bothered by unfriendly, rogue actors. This is not MUSE but it seemed useful to explore.</p>
<p data-line="210" class="code-line" dir="auto">It is also designed to be testable outside its intended deployment. This kind of design certainly <em>is</em> relevant to MUSE and might be important in more than just the MUSE environment. In addition to the debugging benefit, working in a development sandbox means that getting errors when trying stuff has limited consequences.</p>
<div data-line="212" class="code-line" dir="auto"></div>
<a href="drawings/05RemoteProcedures.pdf" target="_blank">
<img src="drawings/05RemoteProcedures.png" align="right" hspace="10"></a>
<p data-line="215" class="code-line" dir="auto">The <a href="docs/lib/remote.html" target="_blank"> <code>lib/remote</code></a>, <a href="docs/lib/dds.html" target="_blank"> <code>lib/dds</code></a>, and <a href="docs/lib/net.html" target="_blank"> <code>lib/net</code> </a> libraries provide the interfaces for the facilities we've been discussing. The drawing shows <a href="drawings/05RemoteProcedures.pdf" target="_blank"> how they fit </a> in the overall context of MUSE.</p>
<div data-line="217" class="code-line" dir="auto"></div>
<a href="code/lib/remote.html" target="_blank">
<img src="drawings/05Tree.jpg" align="left" hspace="10"></a>
<p data-line="220" class="code-line" dir="auto">Look first at <a href="code/lib/remote.html" target="_blank"> <code>lib/remote</code> </a> to see how RPCs work. Review of its code will lead into excursions of <a href="code/lib/dds.html" target="_blank"> <code>lib/dds</code> </a> and more. Then look at how <a href="code/lib/net.html" target="_blank"> <code>lib/net</code> </a>  actually creates (and documents) the remote CLI we said this chapter would discuss. The generated documentation for the remote CLI is <a href="docs/lib/net.html" target="_blank">here</a>. The information in libraries, kept close to the implementation, was all that was needed to generate it. Note that <code>lib/net</code> calls on the same dispatch operations in the targeted libraries as used by local commands.</p>
<p data-line="222" class="code-line" dir="auto">Most of the remote CLI commands are prefaced by a role (<code>farmer</code>, <code>miner</code>, <code>logger</code>, or <code>rover</code>) to target a given turtle. A CLI command prefaced by a role needs a dispatch to the <code>lib/remote</code> handler for that command. As you've likely come to expect, there's not much to these. They're boringly (and helpfully) similar: <a href="code/programs/farmer.html" target="_blank"> <code>farmer</code></a>, <a href="code/programs/miner.html" target="_blank"> <code>miner</code></a>, <a href="code/programs/logger.html" target="_blank"> <code>logger</code></a>, <a href="code/programs/roamer.html" target="_blank"> <code>roamer</code></a>.</p>
<p data-line="224" class="code-line" dir="auto">As a convenience some commands assume a role (and so, a target). For the <code>rover</code>, these are <a href="code/programs/come.html" target="_blank"> <code>come</code> </a> and <a href="code/programs/tail.html" target="_blank"> <code>tail</code> </a>. You may have looked at turtle part of their implementations in <a href="code/lib/roam.html#come" target="_blank"> <code>lib/roam</code></a>. The other part of their implementations is in <a href="code/lib/remote.html#come" target="_blank"> <code>lib/remote</code></a>.</p>
<p data-line="226" class="code-line" dir="auto">There's a role we haven't mentioned till now, the <code>porter</code>. It's associated with a very lonely command computer, just the one of them in the whole MUSE environment. While, for generality, it's possible to send the <code>porter</code> a <a href="code/programs/porter.html" target="_blank"> CLI command </a> prefaced by its role just like the others, actually only a very few of them are useful. It's not a turtle.</p>
<p data-line="228" class="code-line" dir="auto">A library, <a href="code/lib/exec.html" target="_blank"> <code>lib/exec</code></a> uses the <code>porter</code> to provide support for setting up MUSE operations. The <a href="code/lib/exec.html" target="_blank"> <code>lib/exec</code></a> library helps aligning Minecraft coordinates with turtle dead reckoning for ComputerCraft GPS deployment with <a href="code/lib/gps.html" target="_blank"> <code>lib/gps</code> </a>. This is done by the <a href="code/programs/locate.html" target="_blank"> <code>locate</code> </a> command, implemented by <a href="code/lib/exec.html#locate" target="_blank"> <code>exec.locate</code></a>. The library also supports supplying a named MUSE <code>range</code> for the Minecraft's <a href="https://www.digminecraft.com/game_commands/forceload_command.php" target="_blank"> <code>/forceload add</code></a> operation. The command is <a href="code/programs/activate.html" target="_blank"> <code>activate</code> </a> implemented by <a href="code/lib/exec.html#activate" target="_blank"> <code>exec.activate</code></a>.</p>
<div data-line="230" class="code-line" dir="auto"></div>
<a href="drawings/05CommandIntegration.pdf" target="_blank">
<img src="drawings/05CommandIntegration.png" align="right" hspace="10"></a>
<p data-line="233" class="code-line" dir="auto">Since we've gone ahead and used a command computer, we've already demonstrated a shameful lack of constraint. Another command computer indulgence, the <a href="code/lib/port.html" target="_blank"> <code>lib/port</code> </a> library, provides an integration with <code>map.places</code> and the Minecraft <code>teleport</code> command. The   <a href="drawings/05CommandIntegration.pdf" target="_blank"> drawing </a> shows the library in the overall context of MUSE.</p>
<p data-line="235" class="code-line" dir="auto">There's a bit of application design involved in adding a <code>teleport</code> facility to MUSE. The design approach was to make (rough) parallels with real world trips. There's advance booking a trip from somewhere to somewhere else. That generally involves figuring out what the trip costs. Doing the trip with baggage increases the costs. When all that's settled, actually taking the trip makes use of the booking and incurs the cost. Look at <a href="code/lib/port.html" target="_blank"> <code>lib/port</code> </a> to see how that's all worked out in a Minecraft context.</p>
<p data-line="237" class="code-line" dir="auto">Astonishingly it's taken us till now to build up MUSE capability to the point where it would be useful to actually explore operating MUSE in the Minecraft/Computercraft environment. If it seems good for you to do that now, here's a link to guide you through the needed <a href="#appendix-musecraft---running-muse" target="_blank"> <code>setup</code></a>.</p>
<p data-line="239" class="code-line" dir="auto">In the following chapter we'll look at the MUSE libraries that create and make use of what you might think of as a (very simple) <a href="https://en.wikipedia.org/wiki/Declarative_programming" target="_blank"> declarative language </a>. They allow us to describe turtle operations by <em>what</em> is to be done rather than <em>how</em> it is to be done. In some ways, it's another kind of abstraction with the goal of increased maintainability: hiding the detail of <em>how</em> while exposing the main point: <em>what</em>.</p>
<p data-line="241" class="code-line" dir="auto"><a id="Chapter6"></a></p>
<h2 data-line="242" class="code-line" dir="auto" id="chapter-6---planners-and-workers-declarative-programming" tabindex="-1">Chapter 6 - Planners and Workers, Declarative Programming</h2>
<p data-line="244" class="code-line" dir="auto">In this chapter, as threatened, we'll explore the idea of <a href="https://en.wikipedia.org/wiki/Declarative_programming" target="_blank"> declarative programming </a>. We'll look at using this approach for digging shafts and tunnels to mine ores.  The <em>what</em> of all this will get pretty detailed. In some sense, that's the point. The luxury of just saying <em>what</em> is particularly important when there's a lot of detail (that inevitably will get changed). Apologies in advance: this chapter will be unavoidably detailed in the <em>what</em> in order to ground our exploration.</p>
<p data-line="246" class="code-line" dir="auto">The <em>what</em> that is to done for our examples is to dig some holes. In particular, shafts down to a given level and tunnels to mine ore at that level. However, digging is only part of the work. Provisioning a shaft needs, for example, ladders, torches, and storage barrels put just right. For the player's safety, we also need platforms to stand on.</p>
<p data-line="248" class="code-line" dir="auto">Let's start looking at where we want to end up. So that we stay within blocks that Minecraft has <a href="https://minecraft.gamepedia.com/Chunk" target="_blank"> loaded </a>, we want to dig (mostly) down rather than out. Straight down has its own preferably avoidable excitements. So we want to dig in a pattern that snakes back and forth digging</p>
<ul data-line="250" class="code-line" dir="auto">
<li data-line="250" class="code-line" dir="auto"><strong>down and east</strong> (say), then <strong>down and west</strong> (say) to get to a given (odd numbered) level</li>
<li data-line="251" class="code-line" dir="auto">and then dig in a complementary pattern of</li>
<li data-line="252" class="code-line" dir="auto"><strong>down and west</strong>, then <strong>down and east</strong> to get down to the next (even numbered) level.</li>
</ul>
<p data-line="254" class="code-line" dir="auto">The even-odd pattern repeats for as far down as we want to dig.</p>
<p data-line="256" class="code-line" dir="auto">Here are some pictures of what that looks like. First the ladder that got us down to the odd level:</p>
<div data-line="258" class="code-line" dir="auto"></div>
<img src="drawings/06OddLeft.png" align="left" hspace="20">
Next looking east across the platform at that level to the ladder that goes down to the next (even) level:
<br>
<img src="drawings/06OddRight.png" align="right" hspace="10">
<img src="drawings/06Blank.png">
The ladder on the left of this picture is the same one we saw above. Next, imagining we've gone down that ladder to the even level, looking back up the ladder we took going down looks like the next picture.    
<img src="drawings/06Blank.png">
<img src="drawings/06EvenRight.png" align="right" hspace="10">
<p data-line="267" class="code-line" dir="auto">Looking west at that level across the platform looks like the picture below.</p>
<p data-line="269" class="code-line" dir="auto">As you look across the platform you can see the ladder down to the next (odd numbered) layer. If we went down that ladder to the (odd numbered) level just below, it would look like the first picture in this series. That's good: we have a repeating pattern to code to.</p>
<div data-line="271" class="code-line" dir="auto"></div>
<br>
<img src="drawings/06EvenLeft.png" align="left" hspace="20"> 
<br><br><br><br>
<p data-line="275" class="code-line" dir="auto">Note the torches placed on blocks of dirt. It's easy for players to get lost in these tunnels. The torches placed on dirt blocks are anomalous in mines. By their oddity, they stand out. Helpfully, they indicate the way back to the shaft along what we've called the <em>inner</em> tunnels.
<img src="drawings/06Blank.png">
Follow the link to see a <a href="drawings/06SnakeShaft.pdf" target="_blank"> schematic representation </a> of what's going on in these pictures. It shows the <em>what</em> for the work to be done, the repeating pattern shown schematically. The schematic tells a fairly complicated story:
<a href="drawings/06SnakeShaft.pdf" target="_blank">
<img src="drawings/06SnakeShaft.png" align="right" hspace="10"> </a></p>
<ul data-line="281" class="code-line" dir="auto">
<li data-line="281" class="code-line" dir="auto">how the turtle is to <strong>move up and down</strong> between levels in "the plane of motion",</li>
<li data-line="282" class="code-line" dir="auto">where the <strong>ladders and torches</strong> are to be put north of that plane,</li>
<li data-line="283" class="code-line" dir="auto">where fill is to be put to form a <strong>platform for the player</strong>, and, finally,</li>
<li data-line="284" class="code-line" dir="auto">where the <strong><code>marker</code> and  turtle's <code>post</code></strong> is in the shaft at each level.
<br></li>
</ul>
<p data-line="287" class="code-line" dir="auto">We'll use (the numbered) markers to navigate the twists and turns of the mine to get to a <code>post</code>. A <code>post</code> is a place that the mining turtle goes to between operations. Each <code>marker</code> is simply a <code>point</code> as we described when discussing <code>lib/places</code>. It has a particularly structured name and label to make mine navigation work.</p>
<p data-line="289" class="code-line" dir="auto">All this detail motivates a declarative <em>what</em> rather than imperative <em>how</em> approach to writing maintainable code. It's likely obvious that getting all this right the first time isn't very likely. There will be changes. It's easier to make those changes if we can find a declarative representation that pretty much directly follows our (changing) schematic as understanding develops of what must be done.</p>
<p data-line="291" class="code-line" dir="auto">So then, on to how all this works. As is typical, there's two parts to this declarative programming engine: a <em>planner</em>  (a producer of the <em>how</em>, an executable interpretation of the <em>what</em>) and a <em>worker</em>  (consuming that interpretation to actually do the work). Helper libraries provide <em>work functions</em> extending the planner's declarative language for specific situations. In MUSE, the <em>what</em> is a <code>plan</code>. The <code>lib/planner</code> library uses Lua to load a <code>plan</code> and produce its internal representation. This representation is consumed by <code>lib/worker</code>. It's a different kind of dependency. Together these libraries are the procedural engine for the <em>how</em> that supports the declarative <em>what</em>. They take care of the <em>how</em> so you don't have to.</p>
<p data-line="293" class="code-line" dir="auto">The design of the declarative <code>plan</code> "language" is governed by a few principles. We want to: <a id="plan"> </a></p>
<ul data-line="295" class="code-line" dir="auto">
<li data-line="295" class="code-line" dir="auto"><strong>limit the declarative scope</strong> to moving turtles, placing items, and marking places; <em>and  beyond that scope</em>,</li>
<li data-line="296" class="code-line" dir="auto"><strong>extend operations with Lua <em>work functions</em></strong> rather than making a bigger language; <em>and</em></li>
<li data-line="297" class="code-line" dir="auto"><strong>fit well with Lua syntax</strong> to minimize the work (and opportunity for error) in parsing the representation.</li>
</ul>
<p data-line="299" class="code-line" dir="auto">The general idea is to keep it simple and use Lua for the hard stuff. Making the language bigger than it strictly needs to be means there's more (parsing) to get wrong and, just as importantly, more that's unfamiliar. (That's a potential pitfall for <a href="http://staff.um.edu.mt/afra1/seminar/little-languages.pdf" target="_blank"> <em>little languages</em></a>.)</p>
<p data-line="301" class="code-line" dir="auto">One of the strong points for Lua is the coherence between development and operation: Lua <em><strong>is</strong></em> the <a href="https://en.wikipedia.org/wiki/Shell_script" target="_blank"> <em>shell language</em> </a> as well as the general development language. In keeping with this idea, a MUSE plan is just a Lua file. It's easy to escape back to Lua whenever there's the temptation to make the little language a little less little.</p>
<p data-line="303" class="code-line" dir="auto"><a href="drawings/06Declarations.pdf" target="_blank"><img src="drawings/06Declarations.png" align="right" hspace="10"></a>As a guide, here's how the libraries we'll be looking at for mining <a href="drawings/06Declarations.pdf" target="_blank"> fit together</a>. (Click the picture.) For clarity, the drawing just shows these libraries and their dependencies. As you might figure, there's a lot of <a href="https://en.wikipedia.org/wiki/Decomposition_(computer_science)" target="_blank"> factoring </a> (that is, which piece does what) to explore in the design. The <code>mine</code> library is a CLL, Command Line Library. It uses<code>lib/planner</code> to build plans for commands given it and <code>lib/worker</code> to execute them. Work functions for the plan to actually mine ore in our example are provided by <code>lib/grid</code>.</p>
<p data-line="305" class="code-line" dir="auto">Our little language expects to <a href="code/lib/motion.html#moving" target="_blank"> <em>step</em></a> turtle motion in a closure as we discussed way back when we explored <code>lib/motion</code>. At each of these steps, the <em>what</em> operations specified within the declarative scope of our little language are executed and then that optional (Lua) <em>work function</em> is invoked. The escape to <a href="https://en.wikipedia.org/wiki/Procedural_programming" target="_blank"> procedural programming</a> keeps the little language little.</p>
<p data-line="307" class="code-line" dir="auto"><a href="code/lib/planner.html" target="_blank"><img src="drawings/06Tree.jpg" align="left" hspace="10"></a> Look at the <a href="code/lib/planner.html" target="_blank"> <code>lib/planner</code></a> introduction to see the definition of our little language. Then explore the <a href="code/plans/snake.html" target="_blank"> <code>plan</code></a> for a snake shaped shaft to see how the language is used. This is the plan for providing shafts like the one we've been looking at in those pictures. It's how a turtle gets down to where the actual mining is done. Note that <code>funds</code>, the very simple <em>work function</em> for <code>plan/snake</code> is included in the plan definition. There was no need to make a separate library for it. Since the plans are just Lua, we could simply define the function in the plan, just like any other constant.</p>
<p data-line="309" class="code-line" dir="auto">Finally follow the link in the tree back to <a href="code/lib/planner.html" target="_blank"> <code>lib/planner</code></a> to see how it produces an internal representation for the plan that is used by <code>lib/worker</code>.</p>
<p data-line="311" class="code-line" dir="auto">You can explore the <a href="code/lib/worker.html#operate" target="_blank"> <code>worker.execute</code></a> function and follow the code there backward through the library.</p>
<p data-line="313" class="code-line" dir="auto"><em>(We've mentioned earlier, given Lua's one pass compiler, that it may be useful to read Lua files from the end to the beginning after looking at either the file's introduction or an available summary.)</em></p>
<p data-line="315" class="code-line" dir="auto">As you'll see, the only tricky bit in the code, an admittedly tricky <a href=" https://en.wikipedia.org/wiki/Mutual_recursion#:~:text=In%20mathematics%20and%20computer%20science,in%20terms%20of%20each%20other" target="_blank"> mutual recursion</a>, is the code handling (and potentially recovering from) the things that make life tricky for turtles: getting <code>blocked</code>, getting <code>lost</code>, and getting <code>empty</code> (running out of fuel).</p>
<p data-line="317" class="code-line" dir="auto">For reference, here are the summaries for these files: for the <a href="docs/plans/snake.html" target="_blank"> shaft plan</a>, for the <a href="docs/lib/planner.html" target="_blank">  planner </a>, and for the <a href="docs/lib/worker.html" target="_blank">  worker</a>.</p>
<p data-line="319" class="code-line" dir="auto">As we mentioned, The CLL for mining is <code>lib/mine</code>. Here's its <a href="docs/lib/mine.html" target="_blank"> summary</a>. It supports the  remote CLI for mine operations in <a href="code/lib/net.html#mine" target="_blank"><code>lib/net</code>
</a>. The <code>lib/mine</code> <a href="code/lib/mine.html#mine" target="_blank"> implementation </a> is straight forward (and frankly kinda ugly) with a lot of status monitoring and error checking as it loads and runs plans. If you must look, it might be best studied working from the end of the file to the beginning.</p>
<p data-line="322" class="code-line" dir="auto">So far we've only been dealing with the <code>shaft</code> command. Actually drilling tunnels (<code>bore</code>), navigating in the mine (<code>post</code>), and mining the ore (<code>ores</code>) is next.</p>
<p data-line="324" class="code-line" dir="auto">The <code>plan</code> for mine shafts get us down to a given level for mining ore (and back again). Tunnels need to be bored at a given level to find and dig ore at that level. To minimize fuel consumption, all the digging at a given position is done while the turtle is at that position. This results in a cross shaped pattern for tunnels. Here's what that looks like at an even numbered level looking south-west:</p>
<div data-line="326" class="code-line" dir="auto"></div>
<img src="drawings/06CrossEvenTunnels.png">
<p data-line="328" class="code-line" dir="auto">As you can see in the image above, the tunnel running north provides access to the east-west tunnels where the digging for ore is done. A given for Minecraft (or so we're told) is that ore is never found in smaller than 2 by 2 block veins. We can use that assumption to reduce the amount of digging necessary to find ore. <a href="drawings/06CrossSection.pdf" target="_blank"> <img src="drawings/06CrossSection.png" align="right" hspace="10"> </a>. With this in mind, we can follow the link to  look at an <a href="drawings/06CrossSection.pdf" target="_blank"> excavation pattern</a> that is repeated every four blocks vertically and every six blocks horizontally. (For tunnels as well as shafts, a schematic representation of what is to be done is helpful, perhaps even necessary.) The schematic representation in this case is a cross section looking north, showing how tunnels are to be dug to find ore. The blocks labeled "<code>O</code>" are dug in the cross shaped pattern we spoke of earlier. The blocks labeled "<code>--</code>" are adjacent to dug blocks and therefore may be inspected as we dig.</p>
<p data-line="330" class="code-line" dir="auto">One of the repeated patterns is shown with more detail. In that pattern, the dug blocks are labeled "<code>CT</code>" (cut top), "<code>CB</code>" (cut bottom), "<code>CN</code>" (cut north), "<code>CS</code>" (cut south), and "<code>CM</code>" (cut middle). The inspectable blocks are labeled "<code>--</code>" and in the detail they are also numbered. If ore is found in a given numbered block, there may be ore in the 2 x 2 section whose far corner is labelled with that number. We'll dig out that 2 x 2 section. In doing this, we won't dig out any of the other "<code>--</code>" blocks since by doing that we would not be able to see if they showed indications of ore in the 2 x 2 veins they were part of. (Yes, it took a number of failed attempts to get this right. Burying this <em>what</em> in a bunch of <em>how</em> would have been a likely unmaintainable mess.)</p>
<p data-line="332" class="code-line" dir="auto">Finally, we need torches in these tunnels. They are in put the bottom of the cross shaped dig and replaced after any excavation. The plan needs to work even when tunnels run into caves (as shown).</p>
<div data-line="334" class="code-line" dir="auto"></div>
<img src="drawings/06Mine.png" vspace="10">
<p data-line="336" class="code-line" dir="auto">The <em>how</em> that would be needed for any plan for mining in a <code>grid</code> pattern is captured in <code>lib/grid</code>. The <em>what</em> plan for one particular mine geometry, <a href="code/plans/cross.html" target="_blank"><code>plans/cross</code></a>, references <code>lib/grid</code> for the <em>how</em> that will be directly handled  by the Lua functions there.</p>
<p data-line="338" class="code-line" dir="auto"><a href="code/plans/cross.html" target="_blank"><img src="drawings/06Tree.jpg" align="left" vspace="10" hspace="10"></a>Follow the link in the tree to look at the <a href="code/plans/cross.html" target="_blank"> plan</a> for digging, mining, and navigating our tunnels together with the <a href="drawings/06CrossSection.pdf" target="_blank"> cross section drawing</a> to see how the plan follows from the drawing.  The summary of the plan is <a href="docs/plans/cross.html" target="_blank"> here</a>.</p>
<p data-line="340" class="code-line" dir="auto">Note that the tunnels in a <code>cross</code> plan form a (rectangular) <code>grid</code>. As we mentioned before, the <code>cross</code> plan references <code>lib/grid</code> so that the plan itself keeps to the <em>what</em>. There's an awful lot of <em>how</em> in mining. That's kept out of the plan and the <em>little language</em> is kept little. There's a library for that: <a href="code/lib/grid.html" target="_blank"><code>lib/grid</code></a>. As you'll see if you follow the link, it does the most interesting bits.</p>
<p data-line="342" class="code-line" dir="auto">The next chapter takes the declarative idea to another level. Sometimes rather than defining the <code>path</code> of a <code>plan</code> explicitly, it's useful to let MUSE generate a plan by just specifying the three dimensional rectangular <code>bounds</code> that its <code>path</code> should cover. In this case, the support libraries do more so that the client declarations can do less. Because of this, the support libraries wind up being more intertwined with their clients. In particular, control flow passes back and forth between libraries and clients in what might be characterized as a <a href="https://en.wikipedia.org/wiki/Inversion_of_control" target="_blank"> <em>framework inversion of control</em> </a>. Before considering the idea of frameworks, we always saw clients calling libraries. The new and surprising thing here is that the library is also calling its clients. Man bites dog. Different dog.
<br></p>
<h2 data-line="344" class="code-line" dir="auto" id="chapter-7----frameworks-and-factoring-again" tabindex="-1">Chapter 7 -  Frameworks and Factoring (Again)</h2>
<div data-line="345" class="code-line" dir="auto"></div>
<br>
<div data-line="347" class="code-line" dir="auto"></div>
<img src="drawings/07Fields.png">
<p data-line="349" class="code-line" dir="auto">The MUSE framework built around <code>lib/field</code> supports work on a <em>field</em> as defined by a three dimensional rectangular <code>bounds</code>. Each of the files in the <code>fields</code> directory is, as you might guess, a <em>fields file</em>. Each includes declarative representations of what is to be done in their <em>field</em>. One idea they have in common is the idea of a <code>plot</code>. Primarily to deal with the limitations of turtle inventory, plots break the field into pieces that can be dealt with separately. Another thing they have in common is participation in a control framework orchestrated by <code>lib/field</code>.</p>
<p data-line="351" class="code-line" dir="auto">As we'll see, there is a complicated flow of control split between <code>lib/field</code> and its clients. This complexity opens up many unfortunate opportunities for <a href="https://en.wikipedia.org/wiki/Software_rot" target="_blank"> <em>bit rot</em></a>. So whether to create a framework is a design decision to consider carefully. Sometimes though, it's the right way. And sometimes somebody else has made that decision for you. The blow-by-blow control flow documented below is intended as something you can keep in mind in the event that you are confronted by that somebody else's framework or can't resist creating one of your own.</p>
<p data-line="353" class="code-line" dir="auto">For MUSE, the hoped  for compensating benefit from this complicated flow of control is the ability to use the framework to readily define the <em>what</em> for the work to be done on a wide variety of fields because the framework:</p>
<ul data-line="355" class="code-line" dir="auto">
<li data-line="355" class="code-line" dir="auto">leaves the three dimensional <code>bounds</code> geometry of plots in the control of the <code>fields</code> file</li>
<li data-line="356" class="code-line" dir="auto">while generating an fuel efficient <code>path</code> through all the blocks in that geometry;</li>
<li data-line="357" class="code-line" dir="auto">supporting whatever suite of operations on the field is established by a set of <code>fields</code> files; and</li>
<li data-line="358" class="code-line" dir="auto">allowing specification of any <code>plan</code> to do the work for the field along the path.</li>
</ul>
<p data-line="360" class="code-line" dir="auto">It's not like what we saw in <code>lib/mine</code> which knew (in grim detail) all about going down shafts and back up shafts to get to bores which could be used to mine ores. Here <code>lib/field</code> doesn't presume much at all about what's to be done in a field. It's just there to (efficiently) conduct the score that it's given. Here's how:</p>
<div data-line="362" class="code-line" dir="auto"></div>
<img src="drawings/07FrameCalls.png">
<p data-line="364" class="code-line" dir="auto">That score is constrained by <code>lib/field</code> to fit into a specific set of steps to execute a field command.</p>
<ul data-line="366" class="code-line" dir="auto">
<li data-line="366" class="code-line" dir="auto">
<p data-line="366" class="code-line" dir="auto">It all starts by loading the client <code>fields</code> file by <a href="code/lib/field.html#make" target="_blank"> <code>field.make</code></a> (step 1). This produces a function, the <em>field function</em>, <b></b>,</p>
</li>
<li data-line="368" class="code-line" dir="auto">
<p data-line="368" class="code-line" dir="auto">Which is used to call <a href="code/lib/field.html#plot" target="_blank"> <code>field.plot</code></a> (step 2) with its expected arguments.</p>
</li>
<li data-line="370" class="code-line" dir="auto">
<p data-line="370" class="code-line" dir="auto">Those expected arguments include an operation function, <b></b>, associated with the command we were looking to execute. The framework calls that function (as <code>fieldsOp</code>), in <a href="code/lib/field.html#plot" target="_blank"> <code>field.plot</code></a> (step 3).</p>
</li>
<li data-line="372" class="code-line" dir="auto">
<p data-line="372" class="code-line" dir="auto">That function produces the arguments for the call to <code>field.plan</code> (step 4). The arguments include the name of what we'll call a <code>plans</code> file for the operation. The <code>plans</code> files are in the <code>plans</code> directory.</p>
</li>
<li data-line="374" class="code-line" dir="auto">
<p data-line="374" class="code-line" dir="auto">The music continues when <a href="code/lib/field.html#plan" target="_blank"><code>field.plan</code></a> loads that file (step 5) to produce and call the plan function, <b></b>.</p>
</li>
<li data-line="376" class="code-line" dir="auto">
<p data-line="376" class="code-line" dir="auto">The plan function, <b></b> given the game coordinate bounds of the field, calls <a href="code/lib/field.html#paths" target="_blank"> <code>field.paths</code> </a>, a utility not shown. This generates an fuel efficient set of paths (in a surprisingly involved computation). It provides these for the framework (step 6) along with the work function for each path.</p>
</li>
<li data-line="378" class="code-line" dir="auto">
<p data-line="378" class="code-line" dir="auto">The grand finale is when <code>field.plan</code> passes control to <a href="code/lib/field.html#execute" target="_blank"> <code>_field.execute</code></a> (step 7).</p>
</li>
</ul>
<p data-line="380" class="code-line" dir="auto">There's a <code>lib/field</code> utility function, <a href="code/lib/field.html#extents" target="_blank"> <code>field.extents</code></a>, called by <code>plans</code> files which is interesting because it defines a pair of virtual axes, <code>stride</code> and <code>run</code>. These create an abstraction to define plots in terms that may (or may not) be a rotation of game coordinates. The idea is to do the rotation if that would result in longer (more time efficient) turtle runs along the paths. The extents of the supplied <code>bounds</code> of a field are returned as <code>stride</code> and <code>run</code> coordinates. Field operations (that is, turtle runs) are done along the <code>run</code> of a <code>plot</code>. The <code>directions</code> for plots are then virtual: virtual north, <code>vN</code>, virtual east, <code>vE</code>, and so forth.</p>
<p data-line="382" class="code-line" dir="auto">Making a farm involves a lot of work both out there in reality and here in a game. The land needs to be levelled, the soil prepared, and crops planted. Finally, with the farm established, it can be harvested and, perhaps, new seeds planted for the next harvest. Each of these stages coresponds to each of the the <em>field operations</em> defined for a <code>farm</code>.</p>
<p data-line="384" class="code-line" dir="auto">Beating on our orchestration analogy yet some more, the field operations are the movements of the music orchestrated by the set of MUSE <code>fields</code> files. For a <a href="code/lib/farm.html" target="_blank"><code>farm</code></a> they are: <code>quarry</code>, <code>layer</code>, <code>cover</code>, <code>finish</code>, <code>harvest</code>, and <code>path</code>. They're documented in the <a href="code/lib/farm.html" target="_blank"><code>lib/farm</code></a> library of work functions. All are exposed as remote field operations (say for the <code>farmer</code> and the <code>logger</code>) as calls to <code>field.make</code> by <a href="code/lib/net.html#farm" target="_blank"><code>lib/net</code></a>. Nothing in the framework itself imposes these as movements for field operation. They're just what's established by a set of field files.</p>
<p data-line="386" class="code-line" dir="auto"><em>(There's another field operation, <code>test</code>. It's simply a way to do an out of game check that the geometries are correct before plowing up a mess in the game.)</em></p>
<p data-line="388" class="code-line" dir="auto"><a href="code/fields/cane.html" target="_blank"><img src="drawings/07Tree.jpg" align="left" hspace="10"></a>With this overview as context, we'll explore the <code>lib/field</code> framework by looking at some <code>fields</code> files (for steps 2 and 4) and <code>plans</code> files (for step 6) to make this abstraction concrete.</p>
<p data-line="390" class="code-line" dir="auto">The first <code>fields</code> file to explore is <a href="code/fields/cane.html" target="_blank"> <code>fields/cane</code></a>. Declaring the <a href="code/fields/cane.html#plots" target="_blank"> <code>plots</code> </a> for each operation on a cane field does most of what's needed. It's just a lot of picky arithmetic to declare the specifics of <em>what</em> cane fields need to be. The rest of what's needed in a <code>fields</code> file is the definition of the <a href="code/fields/cane.html#ops" target="_blank"> operation functions </a> (<b></b>) executed in support of each field operation.</p>
<p data-line="392" class="code-line" dir="auto">All these operation functions are pretty simple functions as you can see. They are specified as functions since it didn't seem worthwhile to define a declarative language just for this purpose.</p>
<p data-line="394" class="code-line" dir="auto">The <code>plans</code> files for our framework are like the <code>plans</code> files we looked when exploring mines. Except that all its bounds geometry is provided by parameters supplied by <code>lib/fields</code> and all its path geometry is provided by its call to <a href="code/lib/field.html#paths" target="_blank"><code>field.paths</code></a> and <a href="code/lib/field.html#extents" target="_blank"><code>field.extents</code></a> in <code>lib/fields</code>. There's not much to it. It's really a plans <em>prototype</em>.</p>
<p data-line="396" class="code-line" dir="auto">Loading a plans prototype with the bounds parameters from <a href="code/lib/field.html#plan" target="_blank"><code>lib/field</code></a> generates that <em>plan function</em>, <b></b> we spoke of <a href="drawings/07Paths.pdf" target="_blank"><img src="drawings/07Paths.png" align="left" hspace="10" vspace="17"></a>. It calls <a href="code/lib/field.html#paths" target="_blank"> <code>field.paths</code> </a> and <a href="code/lib/field.html#extents" target="_blank"> <code>field.extents</code> </a>to generate a set of efficient paths to work on the volume of a plot. The path generator produces flying <a href="https://www.ri.cmu.edu/pub_files/pub4/choset_howie_1997_3/choset_howie_1997_3.pdf" target="_blank"> ox plow</a> paths through the given three dimensional rectangular bound. Ox plow paths minimize travel to plow a field. Flying oxen (<em>aka</em> turtles) do that in three dimensions. That's the only hard part. As we've said, it's in <a href="code/lib/field.html#paths" target="_blank"><code>lib/fields</code></a>. Together with the resulting simplicity and generality of <code>fields</code> files and <code>plans</code> prototypes, it's what we get for getting involved with the framework.</p>
<p data-line="398" class="code-line" dir="auto">As indicated, there's not much there there in plan prototypes. Look, for example, at the prototype <a href="code/plans/cane.html" target="_blank"> plans/cane</a> file for <a href="code/fields/cane.html" target="_blank"> fields/cane</a>.</p>
<p data-line="400" class="code-line" dir="auto">The other fields files for farming are similarly conceived: <a href="code/fields/crop.html" target="_blank"> crop</a>,<a href="code/fields/tree.html" target="_blank"> tree</a>, and <a href="code/fields/pen.html" target="_blank"> pen</a>. They make use of <code>plans</code> prototypes that look much like the one we've already seen: <a href="code/plans/crop.html" target="_blank"> crop </a>, <a href="code/plans/tree.html" target="_blank"> tree </a>, <a href="code/plans/quarry.html" target="_blank"> quarry</a>, <a href="code/plans/layer.html" target="_blank"> layer</a>, <a href="code/plans/till.html" target="_blank"> till</a>, and <a href="code/plans/path.html" target="_blank"> path</a>.</p>
<p data-line="402" class="code-line" dir="auto">The <code>path</code> plan prototype is used to traverse the path for a <code>range</code> without doing anything else. In the game it provides a way to be a bit more confident that turtles will be doing what you expect when they work the fields. As you may have already seen, it's also exposed as a remote field operation as a call to <code>field.make</code> by <code>lib/net</code>.</p>
<p data-line="404" class="code-line" dir="auto">The plan prototype files are all a little different and just the same. This commonality can lead to an unfortunate amount of ill considered boilerplate. The good news is that it's easy to produce new uses of the framework. The bad news is that it's easy to produce mindless stuff that almost works.</p>
<p data-line="406" class="code-line" dir="auto"><a href="drawings/07Frameworks.pdf" target="_blank"> <img src="drawings/07Frameworks.png" align="right" vspace="10" hspace="10"></a></p>
<p data-line="408" class="code-line" dir="auto">One extra consideration is that many of the <code>plans</code> files construct simple <code>work functions</code> as we talked about for mines. The <code>plans</code> produce the functions consumed and applied by <a href="code/lib/worker.html" target="_blank"> <code>lib/worker</code> </a>. These functions may, in turn,  use more complicated functions defined by <a href="code/lib/farm.html" target="_blank"> <code>lib/farm</code></a>.  Here is a <a href="drawings/07Frameworks.pdf" target="_blank"> drawing</a> showing how the <code>lib/farm</code> and <code>lib/field</code> libraries fit into MUSE.  They use the <a href="code/lib/remote.html" target="_blank"> MUSE RPC </a> and the <a href="code/lib/net.html#field" target="_blank"> RPC dispatch</a> for <code>lib/field</code>.</p>
<p data-line="410" class="code-line" dir="auto">Generating and using this framework involved us in what's been called a <a href="https://en.wikipedia.org/wiki/Separation_of_concerns" target="_blank"> separaration of concerns</a>. Of course, libraries by their nature do this too. And we've talked about factoring before. We just have a more complete illustration of this kind of factoring in the <code>lib/field</code> framework:</p>
<ul data-line="412" class="code-line" dir="auto">
<li data-line="412" class="code-line" dir="auto">
<p data-line="412" class="code-line" dir="auto">The <code>lib/field</code> module itself is just the definitions of a bunch of mechanisms for doing work while efficiently traversing parts (<code>plots</code>) of a three dimensional geometry. It doesn't concern itself with farms and farming. We've used it for that but that's just one possible application of the framework.</p>
</li>
<li data-line="414" class="code-line" dir="auto">
<p data-line="414" class="code-line" dir="auto">The field parts geometry and a set of appropriate field operations are established by <code>fields</code> files. The files don't concern themselves with doing the actual work of farming or how to efficiently traverse the plots of fields. The set of operations does create a common protocol for farm operations exposed by <code>lib/net</code>. This is the user interface for farming.</p>
</li>
<li data-line="416" class="code-line" dir="auto">
<p data-line="416" class="code-line" dir="auto">Given all this, the actual work to be done is determined by <code>plans</code> files. Because the plans don't concern themselves with geometry, they can be reused by <code>fields</code> files as appropriate.</p>
</li>
<li data-line="418" class="code-line" dir="auto">
<p data-line="418" class="code-line" dir="auto">Some common operations for the work specified by <code>plans</code> files is provided by <code>lib/farms</code>. They too have a narrow focus on some specifics of how to do particular tasks.</p>
</li>
</ul>
<p data-line="420" class="code-line" dir="auto">Each piece of this puzzle has a distinct collection of concerns and exposes just the abstractions that the other pieces need. Making the puzzle gets us reuse of the pieces and focussed maintenance on just the piece needing revision.</p>
<p data-line="422" class="code-line" dir="auto"><a href="drawings/07ModelFarm.pdf" target="_blank"> <img src="drawings/07ModelFarm.png" align="left" hspace="10"></a>There's a final level of abstraction we'll explore. Note that what we'll describe is just a bunch of <em>what</em> about making and operating, for example, a farm. There's no <em>how</em>. We mentioned <code>charts</code> back when we explored <code>lib/map</code>. A <em>chart</em> is used in what follows to setup the related fields of a farm in a common geometry.</p>
<p data-line="424" class="code-line" dir="auto">This is laid out, for example in <a href="code/charts/farm40.html" target="_blank"> <code>charts/farm40</code></a>. In the example, for each of the related fields, <code>farm40.lua</code> creates a <em>range</em>. Each range is offset from a common <code>corner</code> <em>reference point</em> of the farm, the <em>farm name</em>,  supplied by the user.  The <code>fields</code> <em>feature</em> of this reference point is a dictionary. If a key in this dictionary is a <em>field name</em> in the farm, the value associated with such a key is the name of a <em>range</em>. The <code>features.fields</code> of this range, in turn, is the name of a <code>field file</code> (like <code>crop</code>, <code>cane</code>, <code>tree</code>, and <code>pen</code>) for the kind of field you might find on a farm (or at least a Minecraft farm). The <code>features</code> design idea developed back in <a href="code/lib/map.html#get" target="_blank"> <code>lib/map</code></a> lets us extend what's in a <code>range</code> and get all the support of a <code>range</code> without changing anything in <code>lib/map</code>.</p>
<p data-line="426" class="code-line" dir="auto">For our chart too, just as previously discussed, the <code>field.make</code> function kicks off a <em>field operation</em>. It expects either the name of a <em>range</em> or a <em>ranged field</em>. This latter is a string including the name of a <em>reference point</em> (like the farm name argument for the <code>corner</code> parameter above) and the <em>field name</em> of a field associated with that reference point (separated by a colon). Together they specify a range for a field in our charted farm. As described above, the <code>fields</code> feature of this range is a dictionary whose keys are names of <code>fields</code> files. The work for a <em>field operation</em> is found in that file.</p>
<p data-line="428" class="code-line" dir="auto">The <code>charts</code> idea only concerns itself with the layout of a farm. It hides a lot of complexity by building on the framework without exposing it. All that framework orchestration is on the other side of the curtain. The mechanisms we've been describing just work on what's defined by a chart. It's the final payoff for dealing with this framework.</p>
<p data-line="430" class="code-line" dir="auto">As a design idea, the <code>charts</code> facility is (scarily) open ended. It's the conventions around its use that make it work. The approach is powerfully unconstrained. It's another power tool. Watch your fingers. There's nothing enforcing (or even supporting) the conventions. Here, again, be rope. Not that there's anything intrinsically wrong with rope.</p>
<p data-line="432" class="code-line" dir="auto">One final note as we conclude. There are a few utility functions we can just point at in <code>lib/field</code>. They support simple operations with simple implementations on <a href="code/lib/field.html#volumes" target="_blank"> volumes</a> defined by pairs of points or a range as named places. Simple operations to <code>cut</code>, <code>fill</code>, <code>till</code>, and <code>fence</code> don't need the complexity of a framework (though they do make use of <code>plans</code>). Kind of a relief really, after what we've been digging around in.</p>
<h2 data-line="434" class="code-line" dir="auto" id="chapter-8---so-this-is-goodbye" tabindex="-1">Chapter 8 - So This Is Goodbye</h2>
<p data-line="436" class="code-line" dir="auto">If you've gone along on this ride, you've been with me on an exploration into some of the ideas and implementation approaches for more maintainable code. It may seem like over engineered work. Of an obsessive compulsive engineer. With way too much time on their hands. (After all, it's just a game.) Perhaps. But, you know, it's never been about the game. At any rate, I hope it will have proved useful to you, maybe even (someday) in the deadline fevered heat of a moment. Maybe you'll just do nothing, stand there for a bit, and think about those AIs from another planet. The ones we met when we first started down this road. You will meet them again.</p>
<p data-line="438" class="code-line" dir="auto"><a href="drawings/08LibrariesAll.pdf" target="_blank"> <img src="drawings/08LibrariesAll.png" align="right" vspace="10" hspace="10"></a></p>
<p data-line="440" class="code-line" dir="auto">Together we've looked at mindfully managing state because there, there be dragons. We've seen how structuring code in libraries can isolate dependencies and create layers of abstraction. All this so design, testing, and maintenance can focus on what's changed when dealing with changes. We looked especially at factoring the code to anticipate (the inevitable) changes to the user interface.</p>
<p data-line="442" class="code-line" dir="auto">We (or at least I) have had fun with functions. We've dealt with state distributed across a network and persisting over time. Distributing state across a network led us into the issues of concurrency, service discovery, and remote procedure calls (that need to deal with error conditions).</p>
<p data-line="444" class="code-line" dir="auto">As part of a developer's bag of tricks (some more magical than others), hey presto, there be declarative little languages and frameworks. If you need them, there they are.</p>
<p data-line="446" class="code-line" dir="auto">The code we've looked at is peppered with documentation. In MUSE, given its goals, this kind of seasoning is particularly heavily applied. However, most code profits from some such. Using CodeMark for concise and expressive code annotation, MUSE gets support for code completion and tool tip supported editing. It does this for a couple of development frameworks. It takes advantage of what type checking there's available for Lua by integrating with <a href="https://luals.github.io/wiki/" target="_blank">LLS</a>, the Lua Language Server. Those libraries we went on (and on) about get summary level markdown and HTML documentation of what they do and the interfaces they support for doing it.</p>
<p data-line="448" class="code-line" dir="auto">Following all those hyperlinks, there's been the opportunity for many field trips outside MUSE. I hope you didn't get too lost.</p>
<p data-line="450" class="code-line" dir="auto">The code for MUSE is part of what's supplied (under an MIT license) for you to use, experiment with, and evolve. There are <code>TODO:</code> comments throughout the code with suggestions for that. All with the intent of learning to develop maintainable code. I'll be interested in what you do with it and to it.</p>
<p data-line="452" class="code-line" dir="auto">Code well.</p>
<h2 data-line="454" class="code-line" dir="auto" id="appendix-musecraft---running-muse" tabindex="-1">Appendix: MUSEcraft - Running MUSE</h2>
<p data-line="455" class="code-line" dir="auto"><a id="appendix"></a></p>
<p data-line="457" class="code-line" dir="auto">When you're ready to try running MUSE in the Minecraft/Computercraft environment, come here for some help in doing so. We'll look at three stages of help: setting up Minecraft for MUSE, getting started with a ComputerCraft world for MUSE, and making changes to MUSE.</p>
<h3 data-line="459" class="code-line" dir="auto" id="minecraft-to-start-with-for-all-the-worlds-you-create" tabindex="-1">Minecraft to Start With for All the Worlds You Create</h3>
<ul data-line="461" class="code-line" dir="auto">
<li data-line="461" class="code-line" dir="auto">
<p data-line="461" class="code-line" dir="auto">First, you'll need a licensed copy of <a href="https://www.minecraft.net/en-us/store/minecraft-java-bedrock-edition-pc" target="_blank"> Minecraft</a>. We've run MUSE with Minecraft 1.20.1. Select that version on the Minecraft launcher and run it once so you can install the rest of the Muse environment.</p>
</li>
<li data-line="463" class="code-line" dir="auto">
<p data-line="463" class="code-line" dir="auto">The MUSE environment depends on Minecraft plugins. Use <a href="https://files.minecraftforge.net/net/minecraftforge/forge/index_1.20.1.html" target="_blank"> Forge</a> to install them. Double click the <code>.jar</code> file to install the Forge client in the .minecraft directory then put the following plugins in the <code>.minecraft/mods</code> folder:</p>
</li>
<li data-line="465" class="code-line" dir="auto">
<p data-line="465" class="code-line" dir="auto"><a href="https://legacy.curseforge.com/minecraft/mc-mods/cc-tweaked/files/4823493" target="_blank"> CC: Tweaked 1.108.4 </a> for Computercraft itself.</p>
</li>
<li data-line="467" class="code-line" dir="auto">
<p data-line="467" class="code-line" dir="auto"><a href="https://www.curseforge.com/minecraft/mc-mods/drp-global-datapack/download/4573646" target="_blank"> Global Packs </a> so that you can use Muse in all the worlds you create.</p>
</li>
<li data-line="469" class="code-line" dir="auto">
<p data-line="469" class="code-line" dir="auto"><a href="https://www.curseforge.com/minecraft/mc-mods/jei/files?page=1&amp;pageSize=20&amp;version=1.20.1" target="_blank"> Just Enough Items 12.1.1.13</a> (which is helpful rather than necessary).</p>
</li>
<li data-line="471" class="code-line" dir="auto">
<p data-line="471" class="code-line" dir="auto">Then create a folder named <code>MUSE</code> in <code>.minecraft/resourcepacks</code>. Download and unzip a <a href="https://github.com/minerbadd/MUSE/releases/latest" target="_blank"> MUSE release </a> and copy the contents of the MUSE release below the release folder itself into the <code>resourcepacks</code> <code>MUSE</code> folder.</p>
</li>
<li data-line="473" class="code-line" dir="auto">
<p data-line="473" class="code-line" dir="auto">Create a MUSE directory and set an environment variable, <code>MUSE_PROJECTS</code> to its path.<br>
(For Windows, use the <code>Advanced System Settings</code> in the <code>System</code> Control Panel)</p>
</li>
<li data-line="476" class="code-line" dir="auto">
<p data-line="476" class="code-line" dir="auto">For Lua's <code>require</code> function, set the <code>LUA_PATH</code> environment variable to include:</p>
<div data-line="477" class="code-line" dir="auto"></div>
<pre> %MUSE_PROJECTS%/CodeMark/?.lua;%MUSE_PROJECTS%/MUSE/data/computercraft/lua/rom/modules/lib/?.lua;;
 </pre>
</li>
<li data-line="481" class="code-line" dir="auto">
<p data-line="481" class="code-line" dir="auto">In the Minecraft launcher, choose the Forge 1.20.1 installation and ask to <code>play</code> it.</p>
</li>
<li data-line="483" class="code-line" dir="auto">
<p data-line="483" class="code-line" dir="auto">When the loader finishes it's work, choose the <code>Options</code> in the Minecraft splash screen. Open <code>Resource Packs</code>. Look for <code>MUSE</code> (and <code>computercraft</code>) among those available. Hover over and click the arrow to include in those selected. Click <code>Done</code>. Back among the <code>Options</code>, click <code>Done</code>. Back in the Minecraft splash screen, Click <code>Single Player</code>.</p>
</li>
<li data-line="485" class="code-line" dir="auto">
<p data-line="485" class="code-line" dir="auto">Create a Minecraft world and launch it. `Open to LAN`` and be sure cheats are enabled. You may prefer a "peaceful" level of difficulty. The seed to create a Desert Village world is 1342300981. The seed to create a Forest Village world is 2583372187968070576.</p>
</li>
<li data-line="487" class="code-line" dir="auto">
<p data-line="487" class="code-line" dir="auto">It may be helpful to use a <a href="https://github.com/Cubitect/cubiomes-viewer" target="_blank">viewer</a> to find a place for your base. Perhaps somewhere reasonably flat to farm and near a village to trade. Check it out safely using the <code>creative</code> gamemode.</p>
</li>
</ul>
<h3 data-line="489" class="code-line" dir="auto" id="next-computercraft-tweaked-and-muse-for-each-world-you-create" tabindex="-1">Next: ComputerCraft (Tweaked) and MUSE for Each World You Create</h3>
<p data-line="491" class="code-line" dir="auto">Setting up the GPS is one of the first things to do in the Minecraft world you created. The coordinates for the GPS you set up need not be aligned with Minecraft coordinates, but it helps in using some game facilities if they are. MUSE provides a way to do this using a command computer. You'll need to enable its use in survival mode. First up, change the configuration settings and increase the storage space on ComputerCraft computers. On Windows, the file to change default settings is at:</p>
<pre><code data-line="492" class="code-line language-md" dir="auto">.minecraft/defaultconfigs/computercraft-server.toml
</code></pre>
<p data-line="495" class="code-line" dir="auto"><em>(We'll use forward slashes in file paths for consistency with non-Windows systems.)</em></p>
<p data-line="497" class="code-line" dir="auto">The settings to include in the configuration are:</p>
<div data-line="498" class="code-line" dir="auto"></div>
<pre>computer_space_limit = 100000000
command_require_creative = false
</pre>
<p data-line="502" class="code-line" dir="auto">There's a <code>computercraft-server.toml</code> file in the <code>MUSE/data</code> directory that you can copy to the <code>.minecraft/defaultconfigs</code> directory. These 'default' settings seem actually to override the settings for all worlds. (If this doesn't work, each world's settings are in the world's <code>saves</code> as <code>.minecraft/saves/&lt;world&gt;/serverconfig/computercraft-server.toml</code>.)</p>
<p data-line="504" class="code-line" dir="auto">Doing much of anything with MUSE turtles will need fuel. For game experience, you can play to acquire fuel and maybe a crafting table (or use the coal supplied by <code>muse:base</code>).</p>
<p data-line="506" class="code-line" dir="auto">With a fuel supply, you can go about setting up (the required) GPS navigation for MUSE. You'll need a pocket computer (the <code>player</code>), a command computer (the <code>porter</code>), a turtle (the <code>rover</code>), and four computers to provide GPS facilities. The GPS computers will need disk drives and a floppy disk. The turtle will need tools. All this lot will need modems. So many, many parts. Running <code>/function muse:base</code> provides all these parts in player inventory, sets the world spawn, and turns off Minecraft <code>DaylightCycle</code> and <code>WeatherCycle</code> (as a convenience).</p>
<p data-line="508" class="code-line" dir="auto">The next step is putting together all those parts to craft what you'll need for the GPS:</p>
<ul data-line="509" class="code-line" dir="auto">
<li data-line="509" class="code-line" dir="auto">Craft the pocket computer with an ender modem on top.</li>
<li data-line="510" class="code-line" dir="auto">(This will be an Advanced Ender Pocket Computer.)</li>
<li data-line="511" class="code-line" dir="auto">Craft a turtle with an ender modem on either the left or right side.</li>
<li data-line="512" class="code-line" dir="auto">Craft a pick axe on the side opposite the modem on that turtle.</li>
<li data-line="513" class="code-line" dir="auto">(This will be an Advanced Ender Mining Turtle)</li>
</ul>
<p data-line="515" class="code-line" dir="auto">You will need to go to <code>/gamemode creative</code> to place the command computer. Place it somewhere convenient with open sky above it. Then go back to <code>/gamemode survival</code> and <code>sneak</code> to place an ender modem on its back.</p>
<p data-line="517" class="code-line" dir="auto">Select and (right) click the <code>player</code> pocket computer to <code>use</code> it. Run the <code>peripherals</code> program to make sure it has a modem. Just as a check, click to <code>use</code> the (<code>porter</code>) command computer and run <code>peripherals</code> on it as well.</p>
<p data-line="519" class="code-line" dir="auto">The rest of the given <code>base</code> inventory will be used to <code>launch</code> the GPS computers. We'll get to that in a bit. First, <code>reboot</code> CraftOS. This registers what you've placed in your world with the MUSE Distributed Discovery Service (DDS) for MQ hosts. There should now be two DDS hosts: <code>player</code> and<code> porter</code>.</p>
<p data-line="521" class="code-line" dir="auto">The reboot involves a bit of indirection. The <code>muse.lua</code> file in the <code>MUSE/data/computercraft/lua/rom/autorun</code> directory is deliberately dead simple:</p>
<div data-line="522" class="code-line" dir="auto"></div>
<pre>--:~ Autorun -&gt; **Enable access to MUSE programs and start MUSE** &lt;- muse/docs/autorun/muse.md
shell.setPath(shell.path()..":".."rom/programs/")
shell.run("rom/modules/.start.lua")
</pre>
<p data-line="527" class="code-line" dir="auto">The reboot runs the <a href="code/daemons/.start.html" target="_blank"> <code>.start</code> </a>
<a href="https://en.wikipedia.org/wiki/Daemon_(computing)" target="_blank">
daemon </a> to establish and report the MUSE game environment and then puts the <code>porter</code> and any turtles (that you'll create) in a <code>MC</code> (MUSE Call) rednet protocol wait loop. This is the RPC wait loop that you saw in <a href="code/lib/remote.html#serverSend" target="_blank"> <code>lib/remote</code> </a>.</p>
<p data-line="531" class="code-line" dir="auto">When the reboot is done, set up to align the GPS coordinates with Minecraft coordinates by placing the Advanced Ender Mining Turtle you crafted on top of the <code>porter</code> command computer.</p>
<p data-line="533" class="code-line" dir="auto">When you mouse the turtle, a number should appear above the turtle as its "nameplate". This is its temporary <code>label</code>. Let's say it's the number <code>2</code>. To assign the role of <code>rover</code> to the turtle, run <code>join rover 2</code> from the <code>player</code> pocket computer (or whatever number appears as its nameplate). This enrolls the turtle in DDS. It will be known as the <code>rover</code> after the next CraftOS <code>reboot</code>, which you should do now..</p>
<p data-line="535" class="code-line" dir="auto">After the reboot, the turtle's nameplate should read as <code>rover</code>.Then run <code>locate</code> from the <code>player</code> pocket computer to name the place above the <code>porter</code> where <code>rover</code> sits and determine <code>rover</code> orientation . Let's say you named the place <code>stage</code>. Once <code>locate</code> has run, move the remaining player inventory items into the <code>rover</code> inventory. Make sure there's clear sky above then issue the <code>launch</code> command (as, say, <code>rover launch stage</code>) with the named place you setup by running <code>locate</code>. The GPS computers will get set in space and have their own startup files that don't enroll them as <code>MQ</code> hosts. After reboot, GPS should now be active. Setup is complete. But there's more.</p>
<p data-line="537" class="code-line" dir="auto">Muse provides support for the idea of a <code>site</code>. There may be several of these in a Minecraft world. Each could have a set of (so called, <code>landed</code>) workers for that site: a <code>farmer</code>, a <code>logger</code>, and a <code>miner</code>. Running <code>/function muse:site</code> as a cheat puts the turtles for a <code>site</code> in player inventory with the needed modems and work tools.  Sites are named using the, ahem, <code>site</code> command with a unique name for the site. When places are named, their names are qualified with the currently established site. When <code>join</code> is run to establish landed turtles turtles in the DDS, they will be given unique, sited roles (and labels) with the currently established site. This is important since <code>rednet</code> hosts need unique names. If you've named places, you can run <code>sync</code> from the <code>player</code> pocket computer to include those places in the new turtles' <code>map</code>.</p>
<p data-line="539" class="code-line" dir="auto">When setting up a new site, you may want to keep site workers working while the player is elsewhere. Use the <code>activate</code> command with a MUSE <code>range</code> encompassing the site to establish the site bounds to keep turtles active while the player is away. (It seems, however, that this won't keep crops growing.)</p>
<p data-line="541" class="code-line" dir="auto">That's it for getting MUSE running in your Minecraft/ComputerCraft world. To see what you can do with MUSE you may want to look at the <a href="docs/help.txt" target="_blank"> programs summary </a> and the <a href="docs/lib/net.html" target="_blank"> remote call summary </a>.</p>
<p data-line="543" class="code-line" dir="auto">If you want to experiment with changes to the MUSE implementation and its documentation, that's next</p>
<h3 data-line="545" class="code-line" dir="auto" id="visual-studio-code-for-source-control-management-syntax-and-type-checking" tabindex="-1">Visual Studio Code for Source Control Management, Syntax and Type Checking</h3>
<p data-line="547" class="code-line" dir="auto">VSC's integration with GitHub makes source control pretty easy. With its help you'll have a remote repository for your code if the not so unimaginable thing happens to access to your local copy. So, first things first, get started with <code>git</code> and Github:</p>
<ul data-line="549" class="code-line" dir="auto">
<li data-line="549" class="code-line" dir="auto">
<p data-line="549" class="code-line" dir="auto">Educate yourself with the very basics of <code>git</code>. There's a free <a href="https://git-scm.com/book/en/v2" target="_blank"> ebook</a>. No need to go deep just now.  Learning just what you need as you need it will be effective. Then get yourself a <a href="https://docs.github.com/en/get-started/start-your-journey/creating-an-account-on-github" target="_blank">GitHub account</a> and install <a href="https://code.visualstudio.com/download" target="_blank">VSC </a>and the extension for <a href="https://code.visualstudio.com/docs/sourcecontrol/intro-to-git" target="_blank">git</a>. Close VSC.</p>
</li>
<li data-line="551" class="code-line" dir="auto">
<p data-line="551" class="code-line" dir="auto">Use VSC to <a href="https://code.visualstudio.com/docs/sourcecontrol/intro-to-git#_clone-a-repository-locally"> clone </a>the <a href="https://github.com/minerbadd/MUSE" target="_blank">MUSE repository </a>into the project directory you created.</p>
</li>
<li data-line="552" class="code-line" dir="auto">
<p data-line="552" class="code-line" dir="auto">If there's a MUSE directory in <code>.minecraft/resourcepacks</code>, remove it. You'll use the (potentially edited) cloned copy instead.  <em>(We'll show forward rather than back slashes for file paths as a bow to industry consistency.)</em></p>
</li>
<li data-line="553" class="code-line" dir="auto">
<p data-line="553" class="code-line" dir="auto">The cloned copy of MUSE is in the project directory. Create a symbolic link to it in <code>.minecraft/resourcepacks</code>. (For Windows, there's a GUI, <a href="https://schinagl.priv.at/nt/hardlinkshellext/linkshellextension.html" target="_blank"> Link Shell Extension</a>, that may be helful.)</p>
</li>
<li data-line="554" class="code-line" dir="auto">
<p data-line="554" class="code-line" dir="auto">Use VSC to clone the <a href="https://github.com/minerbadd/CodeMark" target="_blank">CodeMark repository </a>in your project directory. (So you can keep code completion and type checking current.)</p>
</li>
<li data-line="556" class="code-line" dir="auto">
<p data-line="556" class="code-line" dir="auto">To take advantage of Lua code completion and type checking in VSC you'll need the <code>sumneko.lua</code> (Lua Language Server) extension.</p>
</li>
<li data-line="558" class="code-line" dir="auto">
<p data-line="558" class="code-line" dir="auto">If you change <code>MiningMuse.md</code>, you'll also need the <code>manuth.markdown-converter</code> MarkdownConverter extension to recreate its HTML and PDF files. After it's loaded, go to the VSC settings for Markdown CSS and add <code>markdown.css</code> to the markdown style paths.</p>
</li>
<li data-line="560" class="code-line" dir="auto">
<p data-line="560" class="code-line" dir="auto">Then set the CODEMARK_ASSETS environment variable to the Codemark/assets directory.</p>
</li>
<li data-line="562" class="code-line" dir="auto">
<p data-line="562" class="code-line" dir="auto">You may want a couple of additional extensions: <code>MinecraftCommands.syntax-mcfunction</code> and <code>be5invis.toml</code> (TOML Language Support).</p>
</li>
</ul>
<p data-line="564" class="code-line" dir="auto">There are VSC Lua debug extensions. It would be good to know if they work for what you are doing. Or you could just use VSC for its syntax checking, type checking, and source control management support while using Zerobrane Studio for your run and debug environment. That's next.</p>
<h3 data-line="566" class="code-line" dir="auto" id="zerobrane-studio-zbs-for-a-run-and-debug-envronment" tabindex="-1">Zerobrane Studio (ZBS) for a Run and Debug Envronment</h3>
<p data-line="568" class="code-line" dir="auto">There's not much left to do in setting up your development environment for MUSE but it's arguably the most important part. Making changes to MUSE will mostly involve running code and testing it in the Zerobrane IDE. VSC analysis and source management is critical but not the main event. So, on to the main event:</p>
<ul data-line="570" class="code-line" dir="auto">
<li data-line="570" class="code-line" dir="auto">Follow the installation directions for <a href="https://studio.zerobrane.com/" target="_blank">Zerobrane Studio</a></li>
<li data-line="571" class="code-line" dir="auto">Copy <a href="https://github.com/pkulchenko/ZeroBranePackage/blob/master/README.md" target="_blank">packages </a>:  <code>analyzeall.lua</code> and possibly <code>cloneview.lua</code> into the ZBS <code>package</code> directory</li>
<li data-line="572" class="code-line" dir="auto">Create a symbolic link from <code>CodeMark/apiMark.lua</code> in your project directory to the ZBS <code>package</code> directory. You'll be able to update (but not remove) ZBS code completions for the file you're editing directly from ZBS in the <code>Project</code> drop down menu.</li>
<li data-line="573" class="code-line" dir="auto">Create a symbolic link from <code>MUSE/data/muse/signs/muse.lua</code> to  ZeroBraneStudio's <code>api/lua/</code> directory.</li>
<li data-line="574" class="code-line" dir="auto">Edit (or create) the <code>cfg/user.lua</code> file in your ZBS installation to include <code>api = {'muse'}</code>. You might want to look at the <a href="(http://studio.zerobrane.com/documentation.html" target="_blank"> documentation</a> for information about ZBS configuration.</li>
<li data-line="575" class="code-line" dir="auto">Set the project directory to the MUSE folder in your project directory.</li>
<li data-line="576" class="code-line" dir="auto">Open <code>MUSE/data/muse/assets/museMark.lua</code> and execute it (without debugging). This should produce all fresh, all new, all the code completion, all the type checking files, and all the code documentation for MUSE.</li>
</ul>
<p data-line="578" class="code-line" dir="auto">There are tests for MUSE but no test framework. MUSE tests rely on human review of their output. A framework automating tests would be a useful addition (as would more extensive testing).</p>
<p data-line="580" class="code-line" dir="auto">And that's the lot. There's an <a href="https://github.com/minerbadd/MUSE/issues" target="_blank"> issues</a> reporting page for MUSE if (really when) you find something that needs reporting. All the best.</p>

        <script>var qe=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var He=qe((It,Ie)=>{var ke="Expected a function",Oe=NaN,ot="[object Symbol]",st=/^\s+|\s+$/g,lt=/^[-+]0x[0-9a-f]+$/i,ct=/^0b[01]+$/i,dt=/^0o[0-7]+$/i,ut=parseInt,ft=typeof global=="object"&&global&&global.Object===Object&&global,mt=typeof self=="object"&&self&&self.Object===Object&&self,gt=ft||mt||Function("return this")(),pt=Object.prototype,vt=pt.toString,ht=Math.max,bt=Math.min,pe=function(){return gt.Date.now()};function yt(e,t,n){var r,i,a,s,o,d,m=0,y=!1,T=!1,S=!0;if(typeof e!="function")throw new TypeError(ke);t=De(t)||0,ne(n)&&(y=!!n.leading,T="maxWait"in n,a=T?ht(De(n.maxWait)||0,t):a,S="trailing"in n?!!n.trailing:S);function N(g){var w=r,k=i;return r=i=void 0,m=g,s=e.apply(k,w),s}function re(g){return m=g,o=setTimeout(E,t),y?N(g):s}function X(g){var w=g-d,k=g-m,I=t-w;return T?bt(I,a-k):I}function R(g){var w=g-d,k=g-m;return d===void 0||w>=t||w<0||T&&k>=a}function E(){var g=pe();if(R(g))return D(g);o=setTimeout(E,X(g))}function D(g){return o=void 0,S&&r?N(g):(r=i=void 0,s)}function B(){o!==void 0&&clearTimeout(o),m=0,r=d=i=o=void 0}function Y(){return o===void 0?s:D(pe())}function M(){var g=pe(),w=R(g);if(r=arguments,i=this,d=g,w){if(o===void 0)return re(d);if(T)return o=setTimeout(E,t),N(d)}return o===void 0&&(o=setTimeout(E,t)),s}return M.cancel=B,M.flush=Y,M}function Tt(e,t,n){var r=!0,i=!0;if(typeof e!="function")throw new TypeError(ke);return ne(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),yt(e,t,{leading:r,maxWait:t,trailing:i})}function ne(e){var t=typeof e;return!!e&&(t=="object"||t=="function")}function wt(e){return!!e&&typeof e=="object"}function Et(e){return typeof e=="symbol"||wt(e)&&vt.call(e)==ot}function De(e){if(typeof e=="number")return e;if(Et(e))return Oe;if(ne(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=ne(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=e.replace(st,"");var n=ct.test(e);return n||dt.test(e)?ut(e.slice(2),n?2:8):lt.test(e)?Oe:+e}Ie.exports=Tt});var we="code-line",U=class{constructor(t,n,r){this.element=t;this.line=n;this.codeElement=r;this._detailParentElements=Array.from(Xe(t,"DETAILS"))}_detailParentElements;get isVisible(){return!this._detailParentElements.some(t=>!t.open)}},se=(()=>{let e,t=-1;return n=>{if(!e||n!==t){t=n,e=[new U(document.body,-1)];for(let r of document.getElementsByClassName(we)){if(!(r instanceof HTMLElement))continue;let i=+r.getAttribute("data-line");isNaN(i)||(r.tagName==="CODE"&&r.parentElement&&r.parentElement.tagName==="PRE"?e.push(new U(r.parentElement,i,r)):r.tagName==="UL"||r.tagName==="OL"||e.push(new U(r,i)))}}return e}})();function le(e,t){let n=Math.floor(e),r=se(t),i=r[0]||null;for(let a of r){if(a.line===n)return{previous:a,next:void 0};if(a.line>n)return{previous:i,next:a};i=a}return{previous:i}}function ze(e,t){let n=se(t).filter(d=>d.isVisible),r=e-window.scrollY,i=-1,a=n.length-1;for(;i+1<a;){let d=Math.floor((i+a)/2),m=V(n[d]);m.top+m.height>=r?a=d:i=d}let s=n[a],o=V(s);return a>=1&&o.top>r?{previous:n[i],next:s}:a>1&&a<n.length&&o.top+o.height>r?{previous:s,next:n[a+1]}:{previous:s}}function V({element:e}){let t=e.getBoundingClientRect(),n=e.querySelector(`.${we}`);if(n){let r=n.getBoundingClientRect(),i=Math.max(1,r.top-t.top);return{top:t.top,height:i}}return t}function J(e,t,n){if(!n.settings?.scrollPreviewWithEditor)return;if(e<=0){window.scroll(window.scrollX,0);return}let{previous:r,next:i}=le(e,t);if(!r)return;let a=0,s=V(r),o=s.top;if(i&&i.line!==r.line){let d=(e-r.line)/(i.line-r.line),m=o+s.height,y=i.element.getBoundingClientRect().top-m;a=m+d*y}else{let d=e-Math.floor(e);a=o+s.height*d}window.scroll(window.scrollX,Math.max(1,window.scrollY+a))}function ce(e,t){let{previous:n,next:r}=ze(e,t);if(n){if(n.line<0)return 0;let i=V(n),a=e-window.scrollY-i.top;if(r){let s=a/(V(r).top-i.top);return n.line+s*(r.line-n.line)}else{let s=a/i.height;return n.line+s}}return null}function Ee(e,t){return se(t).find(n=>n.element.id===e)}function*Xe(e,t){for(let n=e.parentElement;n;n=n.parentElement)n.tagName===t&&(yield n)}var Q=class{_current;onDidChangeTextEditorSelection(t,n){let{previous:r}=le(t,n);this._update(r&&(r.codeElement||r.element))}_update(t){this._unmarkActiveElement(this._current),this._markActiveElement(t),this._current=t}_unmarkActiveElement(t){t&&t.classList.toggle("code-active-line",!1)}_markActiveElement(t){t&&t.classList.toggle("code-active-line",!0)}};function Se(e){document.readyState==="loading"||document.readyState==="uninitialized"?document.addEventListener("DOMContentLoaded",e):e()}var Ae=(e,t)=>({postMessage(n,r){e.postMessage({type:n,source:t.settings.source,...r})}});function de(e){let t=document.getElementById("vscode-markdown-preview-data");if(t){let n=t.getAttribute(e);if(n)return n}throw new Error(`Could not load data for ${e}`)}function ue(e){return JSON.parse(de(e))}var Z=class{_settings=ue("data-settings");get settings(){return this._settings}updateSettings(t){this._settings=t}};var Le=11;function Ye(e,t){var n=t.attributes,r,i,a,s,o;if(!(t.nodeType===Le||e.nodeType===Le)){for(var d=n.length-1;d>=0;d--)r=n[d],i=r.name,a=r.namespaceURI,s=r.value,a?(i=r.localName||i,o=e.getAttributeNS(a,i),o!==s&&(r.prefix==="xmlns"&&(i=r.name),e.setAttributeNS(a,i,s))):(o=e.getAttribute(i),o!==s&&e.setAttribute(i,s));for(var m=e.attributes,y=m.length-1;y>=0;y--)r=m[y],i=r.name,a=r.namespaceURI,a?(i=r.localName||i,t.hasAttributeNS(a,i)||e.removeAttributeNS(a,i)):t.hasAttribute(i)||e.removeAttribute(i)}}var ee,Ge="http://www.w3.org/1999/xhtml",b=typeof document>"u"?void 0:document,$e=!!b&&"content"in b.createElement("template"),Ke=!!b&&b.createRange&&"createContextualFragment"in b.createRange();function Je(e){var t=b.createElement("template");return t.innerHTML=e,t.content.childNodes[0]}function Qe(e){ee||(ee=b.createRange(),ee.selectNode(b.body));var t=ee.createContextualFragment(e);return t.childNodes[0]}function Ze(e){var t=b.createElement("body");return t.innerHTML=e,t.childNodes[0]}function et(e){return e=e.trim(),$e?Je(e):Ke?Qe(e):Ze(e)}function te(e,t){var n=e.nodeName,r=t.nodeName,i,a;return n===r?!0:(i=n.charCodeAt(0),a=r.charCodeAt(0),i<=90&&a>=97?n===r.toUpperCase():a<=90&&i>=97?r===n.toUpperCase():!1)}function tt(e,t){return!t||t===Ge?b.createElement(e):b.createElementNS(t,e)}function nt(e,t){for(var n=e.firstChild;n;){var r=n.nextSibling;t.appendChild(n),n=r}return t}function fe(e,t,n){e[n]!==t[n]&&(e[n]=t[n],e[n]?e.setAttribute(n,""):e.removeAttribute(n))}var xe={OPTION:function(e,t){var n=e.parentNode;if(n){var r=n.nodeName.toUpperCase();r==="OPTGROUP"&&(n=n.parentNode,r=n&&n.nodeName.toUpperCase()),r==="SELECT"&&!n.hasAttribute("multiple")&&(e.hasAttribute("selected")&&!t.selected&&(e.setAttribute("selected","selected"),e.removeAttribute("selected")),n.selectedIndex=-1)}fe(e,t,"selected")},INPUT:function(e,t){fe(e,t,"checked"),fe(e,t,"disabled"),e.value!==t.value&&(e.value=t.value),t.hasAttribute("value")||e.removeAttribute("value")},TEXTAREA:function(e,t){var n=t.value;e.value!==n&&(e.value=n);var r=e.firstChild;if(r){var i=r.nodeValue;if(i==n||!n&&i==e.placeholder)return;r.nodeValue=n}},SELECT:function(e,t){if(!t.hasAttribute("multiple")){for(var n=-1,r=0,i=e.firstChild,a,s;i;)if(s=i.nodeName&&i.nodeName.toUpperCase(),s==="OPTGROUP")a=i,i=a.firstChild;else{if(s==="OPTION"){if(i.hasAttribute("selected")){n=r;break}r++}i=i.nextSibling,!i&&a&&(i=a.nextSibling,a=null)}e.selectedIndex=n}}},j=1,Ne=11,Me=3,Ce=8;function O(){}function rt(e){if(e)return e.getAttribute&&e.getAttribute("id")||e.id}function it(e){return function(n,r,i){if(i||(i={}),typeof r=="string")if(n.nodeName==="#document"||n.nodeName==="HTML"||n.nodeName==="BODY"){var a=r;r=b.createElement("html"),r.innerHTML=a}else r=et(r);else r.nodeType===Ne&&(r=r.firstElementChild);var s=i.getNodeKey||rt,o=i.onBeforeNodeAdded||O,d=i.onNodeAdded||O,m=i.onBeforeElUpdated||O,y=i.onElUpdated||O,T=i.onBeforeNodeDiscarded||O,S=i.onNodeDiscarded||O,N=i.onBeforeElChildrenUpdated||O,re=i.skipFromChildren||O,X=i.addChild||function(l,c){return l.appendChild(c)},R=i.childrenOnly===!0,E=Object.create(null),D=[];function B(l){D.push(l)}function Y(l,c){if(l.nodeType===j)for(var p=l.firstChild;p;){var u=void 0;c&&(u=s(p))?B(u):(S(p),p.firstChild&&Y(p,c)),p=p.nextSibling}}function M(l,c,p){T(l)!==!1&&(c&&c.removeChild(l),S(l),Y(l,p))}function g(l){if(l.nodeType===j||l.nodeType===Ne)for(var c=l.firstChild;c;){var p=s(c);p&&(E[p]=c),g(c),c=c.nextSibling}}g(n);function w(l){d(l);for(var c=l.firstChild;c;){var p=c.nextSibling,u=s(c);if(u){var f=E[u];f&&te(c,f)?(c.parentNode.replaceChild(f,c),I(f,c)):w(c)}else w(c);c=p}}function k(l,c,p){for(;c;){var u=c.nextSibling;(p=s(c))?B(p):M(c,l,!0),c=u}}function I(l,c,p){var u=s(c);if(u&&delete E[u],!p){var f=m(l,c);if(f===!1||(f instanceof HTMLElement&&(l=f,g(l)),e(l,c),y(l),N(l,c)===!1))return}l.nodeName!=="TEXTAREA"?Ve(l,c):xe.TEXTAREA(l,c)}function Ve(l,c){var p=re(l,c),u=c.firstChild,f=l.firstChild,F,A,_,$,C;e:for(;u;){for($=u.nextSibling,F=s(u);!p&&f;){if(_=f.nextSibling,u.isSameNode&&u.isSameNode(f)){u=$,f=_;continue e}A=s(f);var K=f.nodeType,P=void 0;if(K===u.nodeType&&(K===j?(F?F!==A&&((C=E[F])?_===C?P=!1:(l.insertBefore(C,f),A?B(A):M(f,l,!0),f=C,A=s(f)):P=!1):A&&(P=!1),P=P!==!1&&te(f,u),P&&I(f,u)):(K===Me||K==Ce)&&(P=!0,f.nodeValue!==u.nodeValue&&(f.nodeValue=u.nodeValue))),P){u=$,f=_;continue e}A?B(A):M(f,l,!0),f=_}if(F&&(C=E[F])&&te(C,u))p||X(l,C),I(C,u);else{var oe=o(u);oe!==!1&&(oe&&(u=oe),u.actualize&&(u=u.actualize(l.ownerDocument||b)),X(l,u),w(u))}u=$,f=_}k(l,f,A);var Te=xe[l.nodeName];Te&&Te(l,c)}var v=n,G=v.nodeType,ye=r.nodeType;if(!R){if(G===j)ye===j?te(n,r)||(S(n),v=nt(n,tt(r.nodeName,r.namespaceURI))):v=r;else if(G===Me||G===Ce){if(ye===G)return v.nodeValue!==r.nodeValue&&(v.nodeValue=r.nodeValue),v;v=r}}if(v===r)S(n);else{if(r.isSameNode&&r.isSameNode(v))return;if(I(v,r,R),D)for(var ie=0,je=D.length;ie<je;ie++){var ae=E[D[ie]];ae&&M(ae,ae.parentNode,!1)}}return!R&&v!==n&&n.parentNode&&(v.actualize&&(v=v.actualize(n.ownerDocument||b)),n.parentNode.replaceChild(v,n)),v}}var at=it(Ye),Pe=at;var me=Object.freeze({http:"http",https:"https",file:"file",untitled:"untitled",mailto:"mailto",vscode:"vscode","vscode-insiders":"vscode-insiders",notebookCell:"vscode-notebook-cell"});function ge(e,t){return t.toLowerCase().startsWith(e+":")}var Re=He(),H=0,Be=new Q,h=new Z,L=0,W=h.settings.source,q=acquireVsCodeApi(),ve=q.getState()??{},x={...ve,...ue("data-state")};typeof ve.scrollProgress<"u"&&ve?.resource!==x.resource&&(x.scrollProgress=0);q.setState(x);var z=Ae(q,h);window.cspAlerter.setPoster(z);window.styleLoadingMonitor.setPoster(z);function he(e){let t=document.getElementsByTagName("img");if(t.length>0){let n=Array.from(t,r=>r.complete?Promise.resolve():new Promise(i=>{r.addEventListener("load",()=>i()),r.addEventListener("error",()=>i())}));Promise.all(n).then(()=>setTimeout(e,0))}else setTimeout(e,0)}Se(()=>{let n=[...new DOMParser().parseFromString(de("data-initial-md-content"),"text/html").body.children];document.body.append(...n);for(let i of n)i instanceof HTMLElement&&be(i);let r=x.scrollProgress;if(Fe(),typeof r=="number"&&!h.settings.fragment){he(()=>{H+=1;let i=Math.max(1,r*document.body.clientHeight);window.scrollTo(0,i)});return}h.settings.scrollPreviewWithEditor&&he(()=>{if(h.settings.fragment){let i;try{i=encodeURIComponent(h.settings.fragment)}catch{i=h.settings.fragment}x.fragment=void 0,q.setState(x);let a=Ee(i,L);a&&(H+=1,J(a.line,L,h))}else isNaN(h.settings.line)||(H+=1,J(h.settings.line,L,h))}),typeof h.settings.selectedLine=="number"&&Be.onDidChangeTextEditorSelection(h.settings.selectedLine,L)});var St=(()=>{let e=Re(t=>{H+=1,he(()=>J(t,L,h))},50);return t=>{isNaN(t)||(x.line=t,e(t))}})();window.addEventListener("resize",()=>{H+=1,We()},!0);function Fe(){let e=document.getElementsByTagName("img"),t=0;for(let n of e){n.id="image-"+t,t+=1;let r=n.getAttribute("data-src"),a=r&&!(ge(me.http,r)||ge(me.https,r))?"localImage":"image";n.setAttribute("data-vscode-context",JSON.stringify({webviewSection:a,id:n.id,preventDefaultContextMenuItems:!0,resource:W,imageSource:r}))}}async function _e(e,t=5){if(!document.hasFocus()&&t>0){setTimeout(()=>{_e(e,t-1)},20);return}try{await navigator.clipboard.write([new ClipboardItem({"image/png":new Promise(n=>{let r=document.createElement("canvas");r!==null&&(r.width=e.naturalWidth,r.height=e.naturalHeight,r.getContext("2d")?.drawImage(e,0,0)),r.toBlob(i=>{i&&n(i),r.remove()},"image/png")})})])}catch(n){console.error(n);let r=window.getSelection();if(!r){await navigator.clipboard.writeText(e.getAttribute("data-src")??e.src);return}r.removeAllRanges();let i=document.createRange();i.selectNode(e),r.addRange(i),document.execCommand("copy"),r.removeAllRanges()}}window.addEventListener("message",async e=>{let t=e.data;switch(t.type){case"copyImage":{let n=document.getElementById(t.id);n instanceof HTMLImageElement&&_e(n);return}case"onDidChangeTextEditorSelection":t.source===W&&Be.onDidChangeTextEditorSelection(t.line,L);return;case"updateView":t.source===W&&St(t.line);return;case"updateContent":{let n=document.querySelector(".markdown-body"),i=new DOMParser().parseFromString(t.content,"text/html");for(let a of Array.from(i.querySelectorAll("meta")))a.hasAttribute("http-equiv")&&a.remove();if(t.source!==W){W=t.source;let a=i.querySelector(".markdown-body");n.replaceWith(a),be(a)}else{let a=i.querySelector(".markdown-body"),s=a.querySelectorAll("link");for(let o of s)o.remove();a.prepend(...s),Pe(n,a,{childrenOnly:!0,onBeforeElUpdated:(o,d)=>{if(Ue(o,d)){let m=o.querySelectorAll("[data-line]"),y=d.querySelectorAll("[data-line]");m.length!==y.length&&console.log("unexpected line number change");for(let T=0;T<m.length;++T){let S=m[T],N=y[T];N&&S.setAttribute("data-line",N.getAttribute("data-line"))}return!1}return o.tagName==="DETAILS"&&d.tagName==="DETAILS"&&o.hasAttribute("open")&&d.setAttribute("open",""),!0},addChild:(o,d)=>{o.appendChild(d),d instanceof HTMLElement&&be(d)}})}++L,window.dispatchEvent(new CustomEvent("vscode.markdown.updateContent")),Fe();break}}},!1);document.addEventListener("dblclick",e=>{if(!h.settings.doubleClickToSwitchToEditor||W.endsWith(".copilotmd"))return;for(let r=e.target;r;r=r.parentNode)if(r.tagName==="A")return;let t=e.pageY,n=ce(t,L);typeof n=="number"&&!isNaN(n)&&z.postMessage("didClick",{line:Math.floor(n)})});var At=["http:","https:","mailto:","vscode:","vscode-insiders:"];document.addEventListener("click",e=>{if(!e)return;let t=e.target;for(;t;){if(t.tagName&&t.tagName==="A"&&t.href){if(t.getAttribute("href").startsWith("#"))return;let n=t.getAttribute("data-href");if(!n&&(n=t.getAttribute("href"),At.some(r=>n.startsWith(r))))return;if(!/^[a-z\-]+:/i.test(n)){z.postMessage("openLink",{href:n}),e.preventDefault(),e.stopPropagation();return}return}t=t.parentNode}},!0);window.addEventListener("scroll",Re(()=>{if(We(),H>0)H-=1;else{let e=ce(window.scrollY,L);typeof e=="number"&&!isNaN(e)&&z.postMessage("revealLine",{line:e})}},50));function We(){x.scrollProgress=window.scrollY/document.body.clientHeight,q.setState(x)}function Ue(e,t){let n=["open"];if(e.isEqualNode(t))return!0;if(e.tagName!==t.tagName||e.textContent!==t.textContent)return!1;let r=[...e.attributes].filter(o=>!n.includes(o.name)),i=[...t.attributes].filter(o=>!n.includes(o.name));if(r.length!==i.length)return!1;for(let o=0;o<r.length;++o){let d=r[o],m=i[o];if(d.name!==m.name||d.value!==m.value&&d.name!=="data-line")return!1}let a=Array.from(e.children),s=Array.from(t.children);return a.length===s.length&&a.every((o,d)=>Ue(o,s[d]))}function be(e){let t=["type","src","nonce","noModule","async"],n=e.tagName==="SCRIPT"?[e]:Array.from(e.getElementsByTagName("script"));for(let r of n){if(!(r instanceof HTMLElement))continue;let i=document.createElement("script"),a=r.innerText;i.text=a;for(let s of t){let o=r.getAttribute?.(s);o&&i.setAttribute(s,o)}r.insertAdjacentElement("afterend",i),r.remove()}}
</script>

    </body>
</html>
