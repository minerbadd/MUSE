<!DOCTYPE html> 
  <html> 
    <head> 
      <link href="../../assets/muse.css" rel="stylesheet" /> 
    </head> 
  <body> 
    <pre>

--:! {map: [] (:)} } <- <b>Map Command Line Library</b> -> muse/docs/lib/map.md      
--:| map: <i>Orientation and position reporting, broadcast and persistence of places</i> -> map  

--:# <b>File and Broadcast Operations for points, trails, and ranges (including features)</b>  

--:: map.place(placeString: ":") -> <i>Instantiate string as named place, include in named places.</i> -> <code>serial: ":", index: #: &!</code>  

--:: map.read(thisMap: ":") -> <i>Reinstantiate places from map file.</i> -> <code>serial: ":", index: #: &!</code>  

--:: map.write(thisMap: ":"?) -> <i>Delete old, write new locally. Default current.</i> -> <code>nil &!</code>  

--:- site name? -> <i>Remote operation to report or change site (persistently) after, e.g., porting <code>rover</code>.</i>  

--:- join site role -> <i>Set site and join landed turtle to it with specified role.</i>  

--:: map.update(serial: ":") -> <i>Append received instantiated MU to local map file</i>. -> <code>nil &!</code>  

--:# <b>Map File Operations</b>  

--:- sync -> <i>Muse Update (MU) broadcast local map to (MQ) registered units.</i>  

--:- erase name -> <i>Remove named place, broadcast Muse eXcise (MX).</i>  

--:# <b>Referenced through <code>map.op</code> for CLI dispatch</b>  

--:: map.erase(name: ":") -> <i>Remove named place, overwrite local map file</i> -> <code>remaining: #:</code>  

--:: map.get(name: ":", key: ":") -> <i>Get named place local feature value for key.</i> -> <code>value: any?</code> &!  

--:: map.gets(name: ":", key: ":") -> <i>Less generic retrieval interface: gets string feature value.</i> -> <code>":"?</code>  

--:: map.put(name: ":", key: ":", value: any?) -> <i>Set named place feature, send MU.</i> ->  <code>key: ":"?, value: any|true|nil &!</code>  

--:: map.puts(name: ":", key: ":", value: ":"?) -> <i>Set string feature value, send MU.</i> -> <code>key: ":", value: ":"|true &!</code>  

--:# <b>Report direction turtle is facing (requires GPS in game)</b>  

--:: map.testFacing(dx: #:, dz: #:) -> <i>Find orientation using position changes for non-zero movement.</i> -> <code>facing: ":" & !</code>  

--:- fix trail? -> <i>Set and report GPS turtle position for dead reckoning. Optionally begin named trailhead.</i>  

--:< <b>Places - Points, Locations, Trails, and Ranges of Maps</b>  

--:- point name label trail? -> <i>Add named labeled point, can start trail, MU updated map. (Player situation needs GPS.)</i>     
--:+ <i>Optional <code>trail</code> starts turtle movement <code>track</code> ended by call to <code>trail</code> limited by <code>Muse.tracking.limit</code>.</i>  

--:: map.set(name: ":", label: ":", x: #:, y: #:, z: #:, f: ":") -> _Set turtle at created point -> ":"  

--:: map.point(name: ":", label: ":", :xyzf:) -> <i>Create, send point update.</i> -> <code>nil & !</code>  

--:: map.locations(template: :[name: ":", offset: xyz], base: ":", label: ":", top: #:) -> <i>Add points offset from base.</i> -> <code>nil</code>    
--:+ <i>Add labelled points using template names and offsets from named base point or top for y-axis.</i>  

--:- trail name label -> <i>Include named point at head and (current situation) tail of a new trail, update map.</i>     
--:+ <i>Call to <code>trail</code> establishes a trail of tracked turtle movements from the head of the trail named and started by <code>point</code>.</i>    
--:+ <i>It also establishes a trail from the tail of the trail named by <code>trail</code> back to the head of the trail.</i>    
--:+ <i>Both trails (from the head to the tail of the <code>trail</code> and back) share a <code>label</code> as specified in the call to <code>trail</code>.</i>    
--:+ <i>Turtles can move along trails with calls to <a href="roam.html#trace" target="_blank"><code>roam.trace</code></a>.</i>   

--:- range name label point point key? value?? -> <i>Volume by named points, optional key and value for feature.</i>   

--:- chart filename ... -> <i>Loads and runs named file in <code>charts</code> directory to create named point and associated ranges.</i>    
--:+ <b>While there are conventions (indicated), there's no restriction in what loading and running the file actually does!</b>    
--:+ <i>The function generated by loading the file is applied to the ... parameters following the chart file name.</i>    
--:+ <i>This chart file function is expected to create ranges establishing the <code>chart</code> and a way to reference those ranges.</i>    
--:+ <i>There is nothing to enforce this expectation. The chart file could do (oh, my) pretty much anything.</i>   

--:: map.borders(range: place) -> <i>Get range elements</i> -> <code>borders, features, position, position &!</code>  

--:> borders: <i>Range boundarires</i> -> {east: #:, west: #:, north: #:, south: #:, top: #:, bottom: #:}  

--:< <b>Navigation in Maps: Where Are We, What's Nearby, and Where Are We Heading?</b>  

--:- at -> <i>Report current (dead reckoning) turtle position and facing or player GPS position.</i>   

--:- test name, label, x, y, z, facing, key?, value??} -> <i>Force mapped position, optionally feature and value for <code>point</code>.</i>  

--:- where place? count?? -> <i>Report movement direction, distance to named place (or all) three (or count) closest places.</i>   

--:- headings rate? place? count?? -> <i>Repeated movement report at specified rate (or every five) seconds).</i>  

--:- near place? span?? -> <i>Report points within span blocks (or all) of named place (or current player or turtle position).</i>  

--:- view place -> <i>Report place details including all situations and features.</i>  

--:# <b>Command Line Interface</b>   

--:: map.op(commands: ":"[]}) -> <i>Command Line Interface</i> -> <code>report: ":" &:</code>  

    </pre>
  </body> 
</html>

