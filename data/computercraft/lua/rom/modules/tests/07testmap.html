<!DOCTYPE html>
 <html>
<head>
<link href="C:\Users\bruce\Desktop\LuaProjects\CodeMark\assets/prism.css" rel="stylesheet" />
<link href="C:\Users\bruce\Desktop\LuaProjects\CodeMark\assets/downmark.css" rel="stylesheet" />
</head>
<body>
<script src="C:\Users\bruce\Desktop\LuaProjects\CodeMark\assets/prism.js"></script>

-- <b>Tests for lib/map</b> interfaces
<p>
dofile(arg[0]:match('.*[/\\]').."/preface.lua");  -- set test environment using <code>preface</code> in execution path
<p>
local core, move, place = require("core").core, require("motion").move, require("places").place
local map, turtle = require("map").map, require("turtle").turtle
local path = _G.Muse.path.."tests/"
<p>
map.map(path.."maps/TM.map"); place.site("TM"); map.charts(path.."charts/")
core.log.level(4); turtle.blocking(false); core.setComputerLabel("tester")
local function test(number, ...) print(".."..number, ...) end
<p>
test(0, map.op({"test", "test0", "label0", "199", "66", "262", "east"}))
local x, y, z, f = move.where(10, 20, 30, "east"); test(0.1, x, y, z, f)
-- face (dx, dz, ew, we, ns, sn) -- face(dx, dz, "east", "west", "south", "north") -> 
local facing = map.testFacing(0, -10, {"east", "west", "south", "north"})
test(0.2, facing, "expect north")
do local xyzf = place.fix({10, 20, 30,"east"});test(0.3,core.string(xyzf)) end
<p>
test(1, core.string(map.op {"point", "test1", "label1"} ))
do local xyzf = place.fix({10, 20, 40,"east"}); test(1.1, core.string(xyzf)) end
test(1.2, core.string(map.op {"point","test2", "label2"} ))
test(1.3, core.string(map.op {"test", "rome", "home", "15", "25", "35", "east"}))
test(1.4, core.string(map.op {"test", "test3", "label3", "10", "20", "30", "east"}))
<p>
test(2, core.string(map.op {"near"}))
test(2.1, core.string(map.op {"near", "10"})) -- span as placeName
test(2.2, core.string(map.op {"near", "test1"}))
test(2.3, core.string(map.op {"near", "test1", "10"}))
test(3, core.string(map.op {"where", nil, 10, 20, 20}))
test(3.1, core.string(map.op {"where", nil, 2, 10, 20, 20}))
test(3.2, core.string(map.op {"where", nil, nil, 15, 20, 25}))
test(3.3, core.string(map.op {"where","test1", nil, 15, 20, 25}))
test(3.4, core.string(map.op {"where", "test1", "2", "15", "20", "25"}))
test(3, core.string(map.op {"where", "10", "20", "20"}))
test(3.1, core.string(map.op {"where", 2, 10, 20, 20}))
test(3.2, core.string(map.op {"where", nil, nil, 15, 20, 25}))
test(3.3, core.string(map.op {"where","test1", nil, 15, 20, 25}))
test(3.4, core.string(map.op {"where", "test1", "2", "15", "20", "25"}))
<p>
test(4, core.string(map.op {"range", "tests", "range", "test1", "test2", "fields", "trees"}))
test(5, map.op {"view", "tests"}); 
<p>
move.set(100, 150, 200, "west"); move.to({100, 150, 200,"west"}); 
test(6, core.string(map.op {"point", "trail20", "test20", "head20"}))
move.set(100, 150, 200,"west"); move.to({100, 160, 210,"west"}); move.to({110, 170, 220,"east"}); move.to({120, 170, 220,"north"})
test(6.1, core.string(map.op {"trail", "tail21", "trail2021"}))
test(6.2, map.op {"view", "trail20"}); -- name, label, features, situations
test(6.3, map.op {"view", "head20"}); 
test(6.4, map.op {"view", "tail21"})
<p>
test(7, map.borders("trail20")) -- map.borders({range}) -> <i>Get range</i> -> <code>{:borders}, {:features}, {:xyzFirst}, {:xyzSecond}</code>
<p>
-- map.put(name: ":", key: ":", [::value]) -> <i>Set feature, cast as Muse Update if named place.</i> ->  <code>false | (key: ":", ::value) & !</code>
test(8, map.put("trail20", "trueKey")); 
test(8.1, map.put("trail20", "textKey", "theText"))
test(8.2, map.put("trail20", "tableKey", {1, 2, 3}))
<p>
--:: map.get(name: ":", key: ":") -> <i>Get feature value for key if named place.</i> -> <code>::value | false</code>
test(9, map.get("trail20", "trueKey")); test(9.1, map.get("trail20", "textKey")); 
test(9.2, map.get("trail20", "tableKey"))
<p>
test(9.3, map.get("trail20", "unknown")); test(9.4, map.op {"view", "trail20"})
<p>
--:- erase name -> <i>Remove named place and broadcast Muse eXcise (MX) to units.</i> 
test(10, map.op {"erase", "trail20"} ); test(10.1, map.op {"view", "trail20"})
<p>
test(11, map.op {"store", "happyplace"})
<p>
local results = map.op {"chart", "TX", "fancy echo", {charted = "table"}, "something else"}
test(12, results)
<p>
  </body> 
</html>

